{
  "openapi": "3.1.1",
  "info": {
    "title": "Usable API",
    "version": "1.4.0",
    "description": "\n# Usable API Documentation\n\nUsable is an AI-enhanced team knowledge platform that enables development teams to capture, organize, and share knowledge through workspace-based collaboration. This API provides endpoints for MCP server integration and direct application access.\n\n## Authentication\n\nThe Usable API supports two authentication methods:\n\n### 1. Personal Access Tokens (Recommended for MCP Servers)\n- Generate tokens via the web interface or /api/tokens endpoint\n- Include in requests via Authorization: Bearer <token> header\n- Tokens can have workspace-specific permissions and expiration dates\n\n### 2. Session-based Authentication\n- Used by the web interface\n- Session cookies managed automatically by NextAuth\n\n## Permission System\n\nUsers have different roles in workspaces:\n- **Owner**: Full workspace control (manage members, delete workspace, all fragment operations)\n- **Collaborator**: Fragment management (create, edit, delete fragments)\n- **Viewer**: Read-only access (view fragments, search)\n- **Subscriber**: View-only access to public workspaces\n\n## Memory Fragment Types\n\nUsable supports four types of knowledge fragments:\n\n1. **Knowledge**: General information and documentation\n2. **Recipe**: Step-by-step guides and tutorials  \n3. **Solution**: Solutions to specific problems and errors\n4. **Template**: Reusable code patterns and project templates\n\n## Error Responses\n\nAll endpoints return consistent error responses with HTTP status codes:\n\n- **400**: Bad Request - Invalid input data\n- **401**: Unauthorized - Missing or invalid authentication\n- **403**: Forbidden - Insufficient permissions\n- **404**: Not Found - Resource does not exist or access denied\n- **500**: Internal Server Error - Server-side error\n    ",
    "contact": {
      "name": "Usable Support",
      "email": "support@usable.dev"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3001",
      "description": "Development server"
    },
    {
      "url": "https://alminni.com",
      "description": "Production server"
    }
  ],
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Personal Access Token for API authentication"
      },
      "SessionAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "next-auth.session-token",
        "description": "Session-based authentication for web interface"
      }
    },
    "schemas": {
      "FragmentType": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string",
            "enum": [
              "Knowledge",
              "Recipe",
              "Solution",
              "Template"
            ],
            "description": "Fragment type name - determines structure and behavior"
          },
          "description": {
            "type": [
              "string",
              "null"
            ]
          },
          "color": {
            "type": "string",
            "description": "Hex color code for UI theming",
            "pattern": "^#[0-9A-Fa-f]{6}$"
          },
          "icon": {
            "type": "string",
            "description": "icon name for UI display"
          },
          "workspaceId": {
            "type": "string",
            "format": "uuid"
          },
          "isActive": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "MemoryFragment": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "workspaceId": {
            "type": "string",
            "format": "uuid"
          },
          "fragmentTypeId": {
            "type": "string",
            "format": "uuid"
          },
          "fragmentType": {
            "$ref": "#/components/schemas/FragmentType"
          },
          "title": {
            "type": "string",
            "maxLength": 500
          },
          "summary": {
            "type": [
              "string",
              "null"
            ]
          },
          "content": {
            "type": "string",
            "description": "Main content - supports Markdown"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Array of tags for categorization and search"
          },
          "status": {
            "type": "string",
            "enum": [
              "draft",
              "published",
              "archived"
            ],
            "description": "Fragment status - only published fragments are searchable"
          },
          "createdVia": {
            "type": "string",
            "enum": [
              "web",
              "mcp",
              "api"
            ],
            "description": "How the fragment was created"
          },
          "authorId": {
            "type": "string",
            "format": "uuid"
          },
          "author": {
            "$ref": "#/components/schemas/User"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "FragmentUpdate": {
        "type": "object",
        "description": "Memory fragment with complete context for MCP server integration",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "workspaceId": {
            "type": "string",
            "format": "uuid"
          },
          "fragmentTypeId": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string",
            "maxLength": 500
          },
          "summary": {
            "type": [
              "string",
              "null"
            ]
          },
          "content": {
            "type": "string",
            "description": "Main content - supports Markdown"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Array of tags for categorization and search"
          },
          "vectorEmbedding": {
            "type": [
              "array",
              "null"
            ],
            "items": {
              "type": "number"
            },
            "description": "AI embedding vector for semantic search"
          },
          "status": {
            "type": "string",
            "enum": [
              "draft",
              "active",
              "archived"
            ],
            "description": "Fragment status - only active fragments are searchable"
          },
          "createdVia": {
            "type": "string",
            "enum": [
              "web",
              "mcp",
              "api"
            ],
            "description": "How the fragment was created"
          },
          "createdBy": {
            "type": "string",
            "format": "uuid",
            "description": "ID of the user who created this fragment"
          },
          "metadata": {
            "type": "object",
            "description": "Additional metadata associated with the fragment"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "author": {
            "type": "object",
            "description": "Information about the fragment author",
            "properties": {
              "id": {
                "type": "string",
                "format": "uuid"
              },
              "name": {
                "type": [
                  "string",
                  "null"
                ],
                "description": "Display name of the author"
              },
              "email": {
                "type": "string",
                "format": "email",
                "description": "Email of the author"
              },
              "image": {
                "type": [
                  "string",
                  "null"
                ],
                "description": "Profile image URL of the author"
              }
            },
            "required": [
              "id",
              "email"
            ]
          },
          "fragmentType": {
            "type": "object",
            "description": "Fragment type information",
            "properties": {
              "id": {
                "type": "string",
                "format": "uuid"
              },
              "name": {
                "type": "string",
                "enum": [
                  "Knowledge",
                  "Recipe",
                  "Solution",
                  "Template"
                ],
                "description": "Fragment type name"
              },
              "description": {
                "type": [
                  "string",
                  "null"
                ],
                "description": "Fragment type description"
              },
              "icon": {
                "type": "string",
                "description": "icon name for UI display"
              },
              "color": {
                "type": "string",
                "description": "Hex color code for UI theming"
              },
              "isSystemDefault": {
                "type": "boolean",
                "description": "Whether this is a system default type"
              }
            },
            "required": [
              "id",
              "name",
              "icon",
              "color",
              "isSystemDefault"
            ]
          },
          "workspace": {
            "type": "object",
            "description": "Workspace information",
            "properties": {
              "id": {
                "type": "string",
                "format": "uuid"
              },
              "name": {
                "type": "string",
                "description": "Name of the workspace"
              },
              "visibility": {
                "type": "string",
                "enum": [
                  "private",
                  "public"
                ],
                "description": "Workspace visibility setting"
              }
            },
            "required": [
              "id",
              "name",
              "visibility"
            ]
          }
        },
        "required": [
          "id",
          "workspaceId",
          "fragmentTypeId",
          "title",
          "content",
          "tags",
          "status",
          "createdVia",
          "createdBy",
          "metadata",
          "createdAt",
          "updatedAt",
          "author",
          "fragmentType",
          "workspace"
        ]
      },
      "AddOperation": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "add"
            ]
          },
          "lineNumber": {
            "type": "integer",
            "minimum": 1,
            "description": "Line number to insert at (1-based indexing)"
          },
          "lines": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "maxItems": 1000,
            "description": "Array of lines to insert"
          }
        },
        "required": [
          "type",
          "lineNumber",
          "lines"
        ],
        "description": "Insert lines at a specific line number"
      },
      "DeleteOperation": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "delete"
            ]
          },
          "startLine": {
            "type": "integer",
            "minimum": 1,
            "description": "First line to delete (1-based indexing, inclusive)"
          },
          "endLine": {
            "type": "integer",
            "minimum": 1,
            "description": "Last line to delete (1-based indexing, inclusive)"
          }
        },
        "required": [
          "type",
          "startLine",
          "endLine"
        ],
        "description": "Delete lines from startLine to endLine (inclusive)"
      },
      "ReplaceOperation": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "replace"
            ]
          },
          "searchText": {
            "type": "string",
            "minLength": 1,
            "description": "Text to search for and replace (exact string match, case-sensitive)"
          },
          "replaceText": {
            "type": "string",
            "description": "Text to replace the found text with (can be empty string for deletion)"
          },
          "replaceAll": {
            "type": "boolean",
            "default": false,
            "description": "If true, replace all occurrences. If false, replace only first occurrence"
          }
        },
        "required": [
          "type",
          "searchText",
          "replaceText"
        ],
        "description": "Search and replace text using exact string matching"
      },
      "PatchOperation": {
        "oneOf": [
          {
            "$ref": "#/components/schemas/AddOperation"
          },
          {
            "$ref": "#/components/schemas/DeleteOperation"
          },
          {
            "$ref": "#/components/schemas/ReplaceOperation"
          }
        ],
        "discriminator": {
          "propertyName": "type",
          "mapping": {
            "add": "#/components/schemas/AddOperation",
            "delete": "#/components/schemas/DeleteOperation",
            "replace": "#/components/schemas/ReplaceOperation"
          }
        },
        "description": "Patch operation for precise content modifications"
      },
      "UpdateFragmentRequest": {
        "type": "object",
        "properties": {
          "fragmentId": {
            "type": "string",
            "format": "uuid",
            "description": "UUID of the fragment to update"
          },
          "title": {
            "type": "string",
            "maxLength": 500,
            "description": "Updated title for the fragment"
          },
          "summary": {
            "type": "string",
            "maxLength": 1000,
            "description": "Updated summary for the fragment"
          },
          "content": {
            "type": "string",
            "maxLength": 50000,
            "description": "Complete content replacement (legacy mode). Cannot be used with patchOperations"
          },
          "patchOperations": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PatchOperation"
            },
            "minItems": 1,
            "maxItems": 100,
            "description": "Array of patch operations for precise content modifications. Cannot be used with content field"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^[a-zA-Z0-9_:-]+$"
            },
            "maxItems": 20,
            "description": "Updated tags for the fragment"
          },
          "fragmentTypeId": {
            "type": "string",
            "format": "uuid",
            "description": "Change fragment type UUID"
          }
        },
        "required": [
          "fragmentId"
        ],
        "description": "Request to update an existing memory fragment. Supports both legacy mode (content field) and patch mode (patchOperations array)"
      },
      "SearchResult": {
        "type": "object",
        "properties": {
          "fragments": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/MemoryFragment"
            }
          },
          "totalCount": {
            "type": "integer"
          },
          "hasMore": {
            "type": "boolean"
          }
        }
      },
      "AgenticSearchRequest": {
        "type": "object",
        "required": [
          "query"
        ],
        "properties": {
          "query": {
            "type": "string",
            "minLength": 1,
            "maxLength": 2000,
            "description": "Natural-language query for vector-based semantic search (matches meaning, not keywords).",
            "examples": [
              "How to configure Next.js API routes with authentication?"
            ]
          },
          "context": {
            "type": "string",
            "maxLength": 3000,
            "description": "Optional additional context to guide relevance."
          },
          "searchIntent": {
            "type": "string",
            "maxLength": 1000,
            "description": "Recommended. Provide a concise high-level objective to bias selection and expansion steps (e.g. 'quick scan', 'deep research', 'summarise onboarding docs'); setting this greatly improves retrieval relevance.",
            "examples": [
              "quick scan"
            ]
          },
          "workspaceId": {
            "type": "string",
            "format": "uuid",
            "description": "Primary workspace scope; overrides workspaceIds if present."
          },
          "workspaceIds": {
            "type": "array",
            "maxItems": 10,
            "items": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Alternative multi-workspace scope when workspaceId is not provided."
          },
          "fragmentTypeId": {
            "type": "string",
            "format": "uuid",
            "description": "Filter results by a specific fragment type ID."
          },
          "tags": {
            "type": "array",
            "maxItems": 10,
            "items": {
              "type": "string"
            },
            "description": "Filter by tags (allowed: a-z, A-Z, 0-9, '_', '-', ':'). Invalid characters are sanitized upstream.",
            "examples": [
              [
                "nextjs",
                "api"
              ]
            ]
          },
          "limit": {
            "type": "integer",
            "minimum": 5,
            "maximum": 50,
            "default": 10,
            "description": "Number of fragments to return (5â€“50)."
          },
          "maxSearchTimeSeconds": {
            "type": "integer",
            "minimum": 1,
            "maximum": 300,
            "description": "Optional maximum search time in seconds. If specified, search will bail early when time limit is reached and return partial results with a timeout indicator."
          },
          "outputFormat": {
            "type": "string",
            "enum": [
              "json",
              "text"
            ],
            "default": "json",
            "description": "Output format for results. 'json' returns structured data (default), 'text' returns human-readable formatted text."
          },
          "invocationAttempt": {
            "type": "integer",
            "minimum": 1,
            "description": "Optional 1-based attempt count supplied by the orchestrating agent to coordinate retries across tool invocations."
          },
          "maxInvocationAttempts": {
            "type": "integer",
            "minimum": 1,
            "description": "Optional ceiling for orchestrator attempts; when reached, the tool short-circuits to avoid redundant retrieval cycles."
          }
        }
      },
      "AgenticSearchResponse": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "description": "The search query that was executed"
          },
          "fragments": {
            "type": "array",
            "description": "Selected fragments with relevance information",
            "items": {
              "type": "object",
              "properties": {
                "fragmentId": {
                  "type": "string",
                  "format": "uuid"
                },
                "title": {
                  "type": "string"
                },
                "reason": {
                  "type": "string",
                  "description": "Explanation of why this fragment was selected"
                },
                "confidence": {
                  "type": "number",
                  "description": "Confidence score (0-1)",
                  "minimum": 0,
                  "maximum": 1
                },
                "createdAt": {
                  "type": "string",
                  "format": "date-time"
                },
                "updatedAt": {
                  "type": "string",
                  "format": "date-time"
                }
              },
              "required": [
                "fragmentId",
                "title",
                "reason",
                "confidence"
              ]
            }
          },
          "executionTimeMs": {
            "type": "integer",
            "description": "Time taken to execute the search in milliseconds"
          },
          "decision": {
            "type": "string",
            "enum": [
              "SUFFICIENT",
              "NEED_MORE"
            ],
            "description": "Whether the search found sufficient information or needs more iterations"
          },
          "invocationLimitReached": {
            "type": "boolean",
            "description": "Whether the invocation limit was reached"
          },
          "invocationAttempt": {
            "type": "integer",
            "description": "Current invocation attempt number"
          },
          "maxInvocationAttempts": {
            "type": "integer",
            "description": "Maximum allowed invocation attempts"
          },
          "iterations": {
            "type": "integer",
            "description": "Number of expansion iterations performed"
          },
          "maxIterations": {
            "type": "integer",
            "description": "Maximum allowed expansion iterations"
          },
          "maxIterationsReached": {
            "type": "boolean",
            "description": "Whether the maximum iterations limit was reached"
          },
          "timeoutReached": {
            "type": "boolean",
            "description": "Whether the search timeout was reached"
          },
          "timeoutSeconds": {
            "type": "integer",
            "description": "Timeout limit in seconds (only present if timeoutReached is true)"
          },
          "reformulations": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Suggested follow-up queries (only present if decision is NEED_MORE)"
          },
          "primed": {
            "type": "array",
            "description": "Initial primed fragments before expansion (only present if fallback was used)",
            "items": {
              "type": "object",
              "properties": {
                "fragmentId": {
                  "type": "string",
                  "format": "uuid"
                },
                "title": {
                  "type": "string"
                },
                "summary": {
                  "type": "string"
                },
                "preview": {
                  "type": "string"
                },
                "createdAt": {
                  "type": "string",
                  "format": "date-time"
                },
                "updatedAt": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          }
        },
        "required": [
          "query",
          "fragments",
          "executionTimeMs",
          "decision"
        ]
      },
      "ListFragmentsRequest": {
        "type": "object",
        "properties": {
          "workspaceId": {
            "type": "string",
            "format": "uuid",
            "description": "Optional. Target workspace UUID. If omitted, searches all accessible workspaces."
          },
          "fragmentTypeId": {
            "type": "string",
            "format": "uuid",
            "description": "Optional. Filter by fragment type UUID."
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Optional. Filter by tags. Returns fragments that have ANY of the specified tags (OR logic).",
            "examples": [
              [
                "nextjs",
                "api"
              ]
            ]
          },
          "where": {
            "type": "string",
            "description": "Optional. SQL WHERE clause for advanced filtering (alias for `query`). Supports operators: =, !=, >, <, >=, <=, LIKE, ILIKE, IN, NOT IN, @> (for JSON arrays). Example: `status = 'active' AND created_at >= '2024-01-01'`",
            "examples": [
              "status = 'active' AND tags @> ARRAY['nextjs']"
            ]
          },
          "query": {
            "type": "string",
            "description": "Optional. SQL WHERE clause for advanced filtering (preferred over `where`). Supports operators: =, !=, >, <, >=, <=, LIKE, ILIKE, IN, NOT IN, @> (for JSON arrays). Example: `status = 'active' AND created_at >= '2024-01-01'`",
            "examples": [
              "status = 'active' AND tags @> ARRAY['nextjs']"
            ]
          },
          "orderBy": {
            "type": "string",
            "description": "Optional. SQL ORDER BY clause. Example: `created_at DESC` or `updated_at ASC` or `title ASC`. Default: `created_at DESC`.",
            "examples": [
              "created_at DESC"
            ]
          },
          "select": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Optional. Array of column names to return. If not specified, returns all columns. Valid columns: id, fragment_type_id, title, summary, status, created_by, created_at, updated_at, tags. Also supports aggregate functions: COUNT(column), SUM(column), AVG(column). Example: ['id', 'title', 'COUNT(*) AS count']",
            "examples": [
              [
                "id",
                "title",
                "status"
              ]
            ]
          },
          "groupBy": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Optional. Array of column names to group by. Required when using aggregate functions with non-aggregate columns. Example: ['status', 'fragment_type_id']",
            "examples": [
              [
                "fragment_type_id"
              ]
            ]
          },
          "createdAfter": {
            "type": "string",
            "format": "date-time",
            "description": "Optional. Filter fragments created after this date (ISO 8601 format).",
            "examples": [
              "2024-01-15T00:00:00Z"
            ]
          },
          "updatedAfter": {
            "type": "string",
            "format": "date-time",
            "description": "Optional. Filter fragments updated after this date (ISO 8601 format).",
            "examples": [
              "2024-01-15T00:00:00Z"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "stale",
              "archived"
            ],
            "description": "Optional. Filter by fragment status. Default: 'active' and 'stale'. Use 'archived' to include archived fragments."
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 20,
            "description": "Maximum number of fragments to return. Default: 20, Max: 100."
          },
          "offset": {
            "type": "integer",
            "minimum": 0,
            "default": 0,
            "description": "Number of fragments to skip for pagination. Default: 0."
          }
        }
      },
      "ListFragmentsResponse": {
        "type": "object",
        "properties": {
          "fragments": {
            "type": "array",
            "description": "Array of fragments. When `isAggregate` is true, contains raw objects with selected columns/aggregate results. When false, contains standard fragment objects.",
            "items": {
              "type": "object",
              "description": "Fragment object (standard format) or raw result object (when using select/aggregate queries)",
              "additionalProperties": true,
              "properties": {
                "id": {
                  "type": "string",
                  "format": "uuid"
                },
                "title": {
                  "type": "string"
                },
                "summary": {
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "tags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "fragmentTypeId": {
                  "type": "string",
                  "format": "uuid"
                },
                "fragmentType": {
                  "$ref": "#/components/schemas/FragmentType"
                },
                "createdAt": {
                  "type": "string",
                  "format": "date-time"
                },
                "updatedAt": {
                  "type": "string",
                  "format": "date-time"
                },
                "author": {
                  "$ref": "#/components/schemas/User"
                },
                "workspaceId": {
                  "type": "string",
                  "format": "uuid"
                },
                "status": {
                  "type": "string",
                  "enum": [
                    "active",
                    "stale",
                    "archived"
                  ]
                }
              }
            }
          },
          "totalCount": {
            "type": "integer",
            "description": "Total number of fragments matching the filters"
          },
          "limit": {
            "type": "integer",
            "description": "Maximum number of fragments requested"
          },
          "offset": {
            "type": "integer",
            "description": "Number of fragments skipped"
          },
          "hasMore": {
            "type": "boolean",
            "description": "Whether there are more results available"
          },
          "isAggregate": {
            "type": "boolean",
            "description": "Whether the response contains aggregate query results (when using COUNT, SUM, AVG with GROUP BY)"
          }
        },
        "required": [
          "fragments",
          "totalCount",
          "limit",
          "offset",
          "hasMore",
          "isAggregate"
        ]
      },
      "SavedSearch": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "workspaceId": {
            "type": "string",
            "format": "uuid"
          },
          "userId": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string",
            "maxLength": 255,
            "description": "Display name for the saved search"
          },
          "query": {
            "type": [
              "string",
              "null"
            ],
            "description": "Search query text"
          },
          "filters": {
            "type": [
              "object",
              "null"
            ],
            "properties": {
              "fragmentTypeIds": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uuid"
                },
                "description": "Filter by fragment type IDs"
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Filter by tags"
              },
              "authors": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uuid"
                },
                "description": "Filter by author user IDs"
              },
              "dateRange": {
                "type": "object",
                "properties": {
                  "from": {
                    "type": "string",
                    "format": "date"
                  },
                  "to": {
                    "type": "string",
                    "format": "date"
                  }
                },
                "description": "Date range filter"
              },
              "createdVia": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "web",
                    "mcp",
                    "api"
                  ]
                },
                "description": "Filter by creation method"
              }
            },
            "description": "Search filters"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the search was saved"
          }
        },
        "required": [
          "id",
          "workspaceId",
          "userId",
          "name",
          "createdAt"
        ]
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "name": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "admin",
              "user"
            ],
            "description": "Global user role"
          },
          "isActive": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "UserAnalyticsSummary": {
        "type": "object",
        "properties": {
          "storage": {
            "type": "object",
            "properties": {
              "totalSizeBytes": {
                "type": "integer",
                "description": "Total storage used in bytes"
              },
              "totalSizeGb": {
                "type": "number",
                "description": "Total storage used in GB"
              },
              "fragmentCount": {
                "type": "integer",
                "description": "Total number of memory fragments"
              },
              "ownedWorkspaceCount": {
                "type": "integer",
                "description": "Number of owned workspaces"
              },
              "currentTier": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "enum": [
                      "free",
                      "starter",
                      "pro",
                      "enterprise"
                    ]
                  },
                  "storageIncludedGb": {
                    "type": "number"
                  },
                  "workspaceLimit": {
                    "type": [
                      "integer",
                      "null"
                    ]
                  }
                }
              },
              "storageAllowanceGb": {
                "type": "number"
              },
              "storageUsedPercentage": {
                "type": "number",
                "description": "Percentage of storage allowance used"
              },
              "isWithinLimits": {
                "type": "boolean",
                "description": "Whether storage is within tier limits"
              },
              "workspaceBreakdown": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "workspaceId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "workspaceName": {
                      "type": "string"
                    },
                    "sizeBytes": {
                      "type": "integer"
                    },
                    "sizeGb": {
                      "type": "number"
                    },
                    "fragmentCount": {
                      "type": "integer"
                    }
                  }
                }
              },
              "monthlyGrowth": {
                "type": "object",
                "properties": {
                  "currentMonthGb": {
                    "type": "number"
                  },
                  "lastMonthGb": {
                    "type": "number"
                  },
                  "growthPercentage": {
                    "type": "number"
                  }
                }
              }
            }
          },
          "embeddings": {
            "type": "object",
            "properties": {
              "weeklyUsage": {
                "type": "object",
                "properties": {
                  "tokensUsed": {
                    "type": "integer"
                  },
                  "tokensLimit": {
                    "type": "integer"
                  },
                  "tokensRemaining": {
                    "type": "integer"
                  },
                  "costCents": {
                    "type": "number"
                  },
                  "tierName": {
                    "type": "string",
                    "enum": [
                      "free",
                      "starter",
                      "pro",
                      "enterprise"
                    ],
                    "description": "User's current subscription tier"
                  },
                  "weekStart": {
                    "type": "string",
                    "format": "date"
                  },
                  "isLimitExceeded": {
                    "type": "boolean"
                  },
                  "usagePercentage": {
                    "type": "number"
                  }
                }
              },
              "monthlyStats": {
                "type": "object",
                "properties": {
                  "totalTokens": {
                    "type": "integer"
                  },
                  "totalCostCents": {
                    "type": "integer"
                  },
                  "requestCount": {
                    "type": "integer"
                  },
                  "successfulRequests": {
                    "type": "integer"
                  },
                  "failedRequests": {
                    "type": "integer"
                  },
                  "averageTokensPerRequest": {
                    "type": "integer"
                  },
                  "successRate": {
                    "type": "number"
                  }
                }
              },
              "historicalUsage": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "weekStart": {
                      "type": "string",
                      "format": "date"
                    },
                    "tokensUsed": {
                      "type": "integer"
                    },
                    "costCents": {
                      "type": "number"
                    }
                  }
                }
              }
            }
          },
          "billing": {
            "type": "object",
            "properties": {
              "currentMonthChargesCents": {
                "type": "integer",
                "description": "Current month charges in cents"
              },
              "projectedMonthChargesCents": {
                "type": "integer",
                "description": "Projected month charges in cents"
              },
              "formattedCurrentCharges": {
                "type": "string",
                "description": "Formatted current charges (e.g., '$1.50')"
              },
              "formattedProjectedCharges": {
                "type": "string",
                "description": "Formatted projected charges (e.g., '$1.50')"
              }
            }
          }
        },
        "required": [
          "storage",
          "embeddings",
          "billing"
        ]
      },
      "AdminCustomer": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "firstName": {
            "type": "string"
          },
          "lastName": {
            "type": "string"
          },
          "fullName": {
            "type": "string"
          },
          "company": {
            "type": [
              "string",
              "null"
            ]
          },
          "subscriptionTier": {
            "type": "string",
            "enum": [
              "free",
              "starter",
              "pro",
              "enterprise"
            ]
          },
          "subscriptionStatus": {
            "type": "string",
            "enum": [
              "active",
              "trialing",
              "past_due",
              "canceled",
              "unpaid",
              "incomplete"
            ]
          },
          "totalRevenueLifetime": {
            "type": "integer",
            "description": "Lifetime revenue in cents"
          },
          "formattedLifetimeRevenue": {
            "type": "string",
            "examples": [
              "$150.00"
            ]
          },
          "currentMonthRevenue": {
            "type": "integer",
            "description": "Current month revenue in cents"
          },
          "formattedCurrentMonthRevenue": {
            "type": "string",
            "examples": [
              "$15.00"
            ]
          },
          "storageUsageGb": {
            "type": "number"
          },
          "workspaceCount": {
            "type": "integer"
          },
          "fragmentCount": {
            "type": "integer"
          },
          "lastActivity": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "email",
          "firstName",
          "lastName",
          "subscriptionTier",
          "subscriptionStatus",
          "createdAt"
        ]
      },
      "AdminCustomerExport": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "firstName": {
            "type": "string"
          },
          "lastName": {
            "type": "string"
          },
          "company": {
            "type": [
              "string",
              "null"
            ]
          },
          "subscriptionTier": {
            "type": "string"
          },
          "subscriptionStatus": {
            "type": "string"
          },
          "stripeCustomerId": {
            "type": [
              "string",
              "null"
            ]
          },
          "stripeSubscriptionId": {
            "type": [
              "string",
              "null"
            ]
          },
          "totalRevenueLifetime": {
            "type": "integer"
          },
          "currentMonthRevenue": {
            "type": "integer"
          },
          "storageUsageGb": {
            "type": "number"
          },
          "storageAllowanceGb": {
            "type": "number"
          },
          "workspaceCount": {
            "type": "integer"
          },
          "fragmentCount": {
            "type": "integer"
          },
          "embeddingTokensUsedThisWeek": {
            "type": "integer"
          },
          "embeddingTokensLimitWeek": {
            "type": "integer"
          },
          "lastActivity": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "AdminCustomerDetail": {
        "type": "object",
        "properties": {
          "profile": {
            "$ref": "#/components/schemas/AdminCustomerProfile"
          },
          "subscription": {
            "type": "object",
            "properties": {
              "tier": {
                "type": "string"
              },
              "status": {
                "type": "string"
              },
              "stripeCustomerId": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "stripeSubscriptionId": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "currentPeriodStart": {
                "type": "string",
                "format": "date-time"
              },
              "currentPeriodEnd": {
                "type": "string",
                "format": "date-time"
              },
              "trialEnd": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              },
              "cancelAtPeriodEnd": {
                "type": "boolean"
              }
            }
          },
          "usage": {
            "type": "object",
            "properties": {
              "storage": {
                "type": "object",
                "properties": {
                  "totalGb": {
                    "type": "number"
                  },
                  "allowanceGb": {
                    "type": "number"
                  },
                  "usagePercentage": {
                    "type": "number"
                  },
                  "workspaceBreakdown": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "workspaceName": {
                          "type": "string"
                        },
                        "sizeGb": {
                          "type": "number"
                        },
                        "fragmentCount": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              },
              "embeddings": {
                "type": "object",
                "properties": {
                  "weeklyTokensUsed": {
                    "type": "integer"
                  },
                  "weeklyTokensLimit": {
                    "type": "integer"
                  },
                  "weeklyUsagePercentage": {
                    "type": "number"
                  },
                  "monthlyTotalTokens": {
                    "type": "integer"
                  },
                  "monthlyTotalRequests": {
                    "type": "integer"
                  }
                }
              }
            }
          },
          "billing": {
            "type": "object",
            "properties": {
              "currentMonthCharges": {
                "type": "integer"
              },
              "projectedMonthCharges": {
                "type": "integer"
              },
              "lifetimeRevenue": {
                "type": "integer"
              },
              "formattedCurrentCharges": {
                "type": "string"
              },
              "formattedProjectedCharges": {
                "type": "string"
              },
              "formattedLifetimeRevenue": {
                "type": "string"
              },
              "recentInvoices": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "amountPaid": {
                      "type": "integer"
                    },
                    "formattedAmount": {
                      "type": "string"
                    },
                    "status": {
                      "type": "string"
                    },
                    "paidAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "invoiceUrl": {
                      "type": "string",
                      "format": "uri"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "AdminCustomerProfile": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "firstName": {
            "type": "string"
          },
          "lastName": {
            "type": "string"
          },
          "fullName": {
            "type": "string"
          },
          "company": {
            "type": [
              "string",
              "null"
            ]
          },
          "role": {
            "type": "string"
          },
          "isActive": {
            "type": "boolean"
          },
          "lastLoginAt": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "preferences": {
            "type": "object",
            "properties": {
              "theme": {
                "type": "string"
              },
              "notifications": {
                "type": "boolean"
              },
              "marketingEmails": {
                "type": "boolean"
              }
            }
          },
          "metadata": {
            "type": "object",
            "properties": {
              "signupSource": {
                "type": "string"
              },
              "referralCode": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "utmSource": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "utmMedium": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "utmCampaign": {
                "type": [
                  "string",
                  "null"
                ]
              }
            }
          }
        }
      },
      "AdminCustomerSubscription": {
        "type": "object",
        "properties": {
          "subscription": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "status": {
                "type": "string"
              },
              "tierName": {
                "type": "string"
              },
              "stripeCustomerId": {
                "type": "string"
              },
              "stripeSubscriptionId": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "currentPeriodStart": {
                "type": "string",
                "format": "date-time"
              },
              "currentPeriodEnd": {
                "type": "string",
                "format": "date-time"
              },
              "trialStart": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              },
              "trialEnd": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              },
              "cancelAt": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              },
              "cancelAtPeriodEnd": {
                "type": "boolean"
              },
              "createdAt": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "billingHistory": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "invoiceId": {
                  "type": "string"
                },
                "amount": {
                  "type": "integer"
                },
                "formattedAmount": {
                  "type": "string"
                },
                "status": {
                  "type": "string"
                },
                "description": {
                  "type": "string"
                },
                "periodStart": {
                  "type": "string",
                  "format": "date-time"
                },
                "periodEnd": {
                  "type": "string",
                  "format": "date-time"
                },
                "paidAt": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "format": "date-time"
                },
                "createdAt": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          },
          "usageRecords": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "periodStart": {
                  "type": "string",
                  "format": "date-time"
                },
                "periodEnd": {
                  "type": "string",
                  "format": "date-time"
                },
                "storageGb": {
                  "type": "number"
                },
                "embeddingTokens": {
                  "type": "integer"
                },
                "storageCharges": {
                  "type": "integer"
                },
                "embeddingCharges": {
                  "type": "integer"
                },
                "totalCharges": {
                  "type": "integer"
                },
                "formattedStorageCharges": {
                  "type": "string"
                },
                "formattedEmbeddingCharges": {
                  "type": "string"
                },
                "formattedTotalCharges": {
                  "type": "string"
                }
              }
            }
          },
          "paymentMethods": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "type": {
                  "type": "string"
                },
                "brand": {
                  "type": "string"
                },
                "last4": {
                  "type": "string"
                },
                "expMonth": {
                  "type": "integer"
                },
                "expYear": {
                  "type": "integer"
                },
                "isDefault": {
                  "type": "boolean"
                },
                "createdAt": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          }
        }
      },
      "Workspace": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string",
            "maxLength": 255
          },
          "description": {
            "type": [
              "string",
              "null"
            ]
          },
          "visibility": {
            "type": "string",
            "enum": [
              "private",
              "public"
            ],
            "description": "Workspace visibility - public workspaces can be discovered and subscribed to"
          },
          "ownerId": {
            "type": "string",
            "format": "uuid"
          },
          "owner": {
            "$ref": "#/components/schemas/User"
          },
          "memberRole": {
            "type": "string",
            "enum": [
              "owner",
              "collaborator",
              "viewer",
              "subscriber"
            ],
            "description": "Current user's role in this workspace"
          },
          "memberCount": {
            "type": "integer",
            "minimum": 0
          },
          "fragmentCount": {
            "type": "integer",
            "minimum": 0
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "archivedAt": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          }
        }
      },
      "WorkspaceMember": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "workspaceId": {
            "type": "string",
            "format": "uuid"
          },
          "userId": {
            "type": "string",
            "format": "uuid"
          },
          "user": {
            "$ref": "#/components/schemas/User"
          },
          "role": {
            "type": "string",
            "enum": [
              "owner",
              "collaborator",
              "viewer"
            ],
            "description": "Member role in workspace"
          },
          "invitedAt": {
            "type": "string",
            "format": "date-time"
          },
          "joinedAt": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          }
        }
      },
      "ConceptEvolution": {
        "type": "object",
        "required": [
          "x",
          "y",
          "z"
        ],
        "properties": {
          "x": {
            "type": "string",
            "minLength": 1,
            "examples": [
              "microservices"
            ]
          },
          "y": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "minItems": 1,
            "examples": [
              [
                "service mesh",
                "distributed systems"
              ]
            ]
          },
          "z": {
            "type": "string",
            "minLength": 1,
            "examples": [
              "modularity"
            ]
          },
          "type": {
            "type": [
              "string",
              "null"
            ],
            "examples": [
              "technical"
            ]
          }
        }
      },
      "TagAlias": {
        "type": "object",
        "required": [
          "tag",
          "aliases"
        ],
        "properties": {
          "tag": {
            "type": "string",
            "minLength": 1,
            "examples": [
              "ai"
            ]
          },
          "aliases": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "minItems": 1,
            "examples": [
              [
                "artificial intelligence",
                "ml"
              ]
            ]
          },
          "reason": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "WorkspaceSettings": {
        "type": "object",
        "properties": {
          "conceptEvolution": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ConceptEvolution"
            },
            "default": []
          },
          "tagAliases": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TagAlias"
            },
            "default": []
          },
          "allowGuestAccess": {
            "type": "boolean"
          },
          "defaultMemberRole": {
            "type": "string",
            "enum": [
              "owner",
              "collaborator",
              "viewer"
            ]
          },
          "aiGraphEnabled": {
            "type": "boolean"
          }
        }
      },
      "WorkspaceSettingsResponse": {
        "type": "object",
        "properties": {
          "workspaceId": {
            "type": "string",
            "format": "uuid"
          },
          "workspaceName": {
            "type": "string"
          },
          "settings": {
            "$ref": "#/components/schemas/WorkspaceSettings"
          }
        }
      },
      "UpdateWorkspaceSettingsRequest": {
        "type": "object",
        "properties": {
          "conceptEvolution": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ConceptEvolution"
            }
          },
          "tagAliases": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TagAlias"
            }
          }
        }
      },
      "File": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "File ID (short UUID without dashes)",
            "examples": [
              "a1b2c3d4e5f6"
            ]
          },
          "workspaceId": {
            "type": "string",
            "format": "uuid",
            "description": "ID of the workspace this file belongs to"
          },
          "name": {
            "type": "string",
            "maxLength": 500,
            "description": "File name (sanitized)",
            "examples": [
              "document.pdf"
            ]
          },
          "mimeType": {
            "type": "string",
            "description": "MIME type of the file",
            "examples": [
              "application/pdf"
            ]
          },
          "sizeBytes": {
            "type": "integer",
            "minimum": 0,
            "description": "File size in bytes",
            "examples": [
              1024000
            ]
          },
          "checksum": {
            "type": "string",
            "description": "SHA-256 checksum of the file content",
            "examples": [
              "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
            ]
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Tags for file categorization and search",
            "examples": [
              [
                "document",
                "report",
                "2024"
              ]
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "deleted"
            ],
            "description": "File status",
            "examples": [
              "active"
            ]
          },
          "uploadedBy": {
            "type": "string",
            "format": "uuid",
            "description": "ID of the user who uploaded the file"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the file was uploaded"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the file was last updated"
          }
        },
        "required": [
          "id",
          "workspaceId",
          "name",
          "mimeType",
          "sizeBytes",
          "checksum",
          "status"
        ]
      },
      "FileUploadRequest": {
        "type": "object",
        "description": "File upload request using multipart/form-data",
        "properties": {
          "file": {
            "type": "string",
            "description": "File to upload (multipart/form-data). Max size: 50MB",
            "contentMediaType": "application/octet-stream"
          },
          "workspaceId": {
            "type": "string",
            "format": "uuid",
            "description": "Workspace ID to upload the file to"
          },
          "tags": {
            "type": "string",
            "description": "JSON array or comma-separated list of tags",
            "examples": [
              "[\"document\", \"report\"]"
            ]
          }
        },
        "required": [
          "file",
          "workspaceId"
        ]
      },
      "FileUploadResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "examples": [
              true
            ]
          },
          "fileId": {
            "type": "string",
            "description": "File ID for status polling",
            "examples": [
              "a1b2c3d4e5f6"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "uploading"
            ],
            "description": "Initial upload status",
            "examples": [
              "uploading"
            ]
          },
          "message": {
            "type": "string",
            "examples": [
              "File upload initiated"
            ]
          }
        },
        "required": [
          "success",
          "fileId",
          "status"
        ]
      },
      "FileStatus": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "uploading",
              "complete",
              "corrupted",
              "error"
            ],
            "description": "Current upload status"
          },
          "progress": {
            "type": "integer",
            "minimum": 0,
            "maximum": 100,
            "description": "Upload progress percentage (0-100)",
            "examples": [
              75
            ]
          }
        },
        "required": [
          "status"
        ]
      },
      "FileMetadata": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "examples": [
              "a1b2c3d4e5f6"
            ]
          },
          "name": {
            "type": "string",
            "examples": [
              "document.pdf"
            ]
          },
          "mimeType": {
            "type": "string",
            "examples": [
              "application/pdf"
            ]
          },
          "sizeBytes": {
            "type": "integer",
            "examples": [
              1024000
            ]
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "examples": [
              [
                "document",
                "report"
              ]
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "deleted"
            ]
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "workspace": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "format": "uuid"
              },
              "name": {
                "type": "string"
              }
            }
          },
          "uploadedBy": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "format": "uuid"
              },
              "name": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "email": {
                "type": "string",
                "format": "email"
              }
            }
          }
        },
        "required": [
          "id",
          "name",
          "mimeType",
          "sizeBytes",
          "status"
        ]
      },
      "FileUpdate": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 500,
            "description": "New file name (optional)"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Updated tags array (optional)"
          }
        }
      },
      "FileSearchResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "examples": [
              true
            ]
          },
          "files": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FileMetadata"
            }
          },
          "total": {
            "type": "integer",
            "description": "Total number of files matching the search",
            "examples": [
              42
            ]
          },
          "limit": {
            "type": "integer",
            "description": "Number of results per page",
            "examples": [
              50
            ]
          },
          "offset": {
            "type": "integer",
            "description": "Number of results skipped",
            "examples": [
              0
            ]
          }
        },
        "required": [
          "success",
          "files",
          "total"
        ]
      },
      "FileAttachment": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "Attachment ID"
          },
          "fileId": {
            "type": "string",
            "description": "File ID",
            "examples": [
              "a1b2c3d4e5f6"
            ]
          },
          "fragmentId": {
            "type": "string",
            "format": "uuid",
            "description": "Fragment ID this file is attached to"
          },
          "description": {
            "type": [
              "string",
              "null"
            ],
            "description": "Optional description of the attachment"
          },
          "displayOrder": {
            "type": "integer",
            "description": "Display order for sorting attachments",
            "examples": [
              0
            ]
          },
          "attachedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the file was attached"
          },
          "file": {
            "$ref": "#/components/schemas/FileMetadata",
            "description": "Attached file metadata"
          }
        },
        "required": [
          "id",
          "fileId",
          "fragmentId",
          "attachedAt"
        ]
      },
      "FileAttachmentRequest": {
        "type": "object",
        "properties": {
          "fragmentId": {
            "type": "string",
            "format": "uuid",
            "description": "Fragment ID to attach the file to"
          },
          "description": {
            "type": "string",
            "maxLength": 500,
            "description": "Optional description of the attachment"
          },
          "displayOrder": {
            "type": "integer",
            "minimum": 0,
            "description": "Display order for sorting (default: 0)",
            "examples": [
              0
            ]
          }
        },
        "required": [
          "fragmentId"
        ]
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Authentication required",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "default": {
                "value": {
                  "error": "Unauthorized"
                }
              }
            }
          }
        }
      },
      "ForbiddenError": {
        "description": "Insufficient permissions",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "default": {
                "value": {
                  "error": "Insufficient permissions"
                }
              }
            }
          }
        }
      },
      "NotFoundError": {
        "description": "Resource not found or access denied",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "default": {
                "value": {
                  "error": "Resource not found"
                }
              }
            }
          }
        }
      },
      "ValidationError": {
        "description": "Invalid input data",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ValidationError"
            }
          }
        }
      },
      "InternalServerError": {
        "description": "Internal server error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "examples": {
              "default": {
                "value": {
                  "error": "Internal server error"
                }
              }
            }
          }
        }
      }
    }
  },
  "security": [
    {
      "BearerAuth": []
    },
    {
      "SessionAuth": []
    }
  ],
  "tags": [
    {
      "name": "Authentication",
      "description": "Authentication and token management"
    },
    {
      "name": "Workspaces",
      "description": "Workspace management and membership"
    },
    {
      "name": "Memory Fragments",
      "description": "Knowledge fragment CRUD operations"
    },
    {
      "name": "Search",
      "description": "Search and discovery endpoints"
    },
    {
      "name": "Fragment Types",
      "description": "Fragment type management"
    },
    {
      "name": "Notifications",
      "description": "User notifications"
    },
    {
      "name": "Profile",
      "description": "User profile management"
    },
    {
      "name": "Health",
      "description": "API health and status"
    },
    {
      "name": "AI",
      "description": "AI-powered features and integrations"
    },
    {
      "name": "MCP Integration",
      "description": "Model Context Protocol server integration endpoints"
    },
    {
      "name": "Files",
      "description": "File upload, management, and fragment attachment operations"
    }
  ],
  "paths": {
    "/api/auth/signin": {
      "get": {
        "summary": "Display authentication providers",
        "description": "Show available authentication providers for sign-in. Typically renders a sign-in page with OAuth provider buttons.",
        "tags": [
          "Authentication"
        ],
        "parameters": [
          {
            "name": "callbackUrl",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "uri"
            },
            "description": "URL to redirect to after successful authentication",
            "examples": {
              "default": {
                "value": "/dashboard"
              }
            }
          },
          {
            "name": "error",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Error message to display on sign-in page",
            "examples": {
              "default": {
                "value": "CredentialsSignin"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sign-in page HTML",
            "content": {
              "text/html": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "302": {
            "description": "Redirect to provider (if direct provider specified)",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "Redirect URL"
              }
            }
          }
        }
      },
      "post": {
        "summary": "Initiate authentication",
        "description": "Start the authentication process with the specified provider",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "required": [
                  "provider"
                ],
                "properties": {
                  "provider": {
                    "type": "string",
                    "description": "Authentication provider ID",
                    "examples": [
                      "keycloak"
                    ]
                  },
                  "callbackUrl": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to redirect to after authentication",
                    "examples": [
                      "/dashboard"
                    ]
                  },
                  "csrfToken": {
                    "type": "string",
                    "description": "CSRF protection token"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "302": {
            "description": "Redirect to authentication provider",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "Provider OAuth authorization URL"
              }
            }
          },
          "400": {
            "description": "Invalid request (missing provider, invalid CSRF token, etc.)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid provider"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/signout": {
      "get": {
        "summary": "Display sign-out confirmation",
        "description": "Show sign-out confirmation page",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Sign-out confirmation page HTML",
            "content": {
              "text/html": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Sign out user",
        "description": "Sign out the current user and invalidate their session",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "required": [
                  "csrfToken"
                ],
                "properties": {
                  "csrfToken": {
                    "type": "string",
                    "description": "CSRF protection token"
                  },
                  "callbackUrl": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to redirect to after sign-out",
                    "examples": [
                      "/"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "302": {
            "description": "Redirect after successful sign-out",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "Redirect URL (callbackUrl or default)"
              }
            }
          }
        }
      }
    },
    "/api/auth/callback/{provider}": {
      "get": {
        "summary": "OAuth callback handler",
        "description": "Handle OAuth callback from authentication provider (Keycloak). This endpoint receives the authorization code and completes the OAuth flow.",
        "tags": [
          "Authentication"
        ],
        "parameters": [
          {
            "name": "provider",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "keycloak"
              ]
            },
            "description": "OAuth provider identifier",
            "examples": {
              "default": {
                "value": "keycloak"
              }
            }
          },
          {
            "name": "code",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "OAuth authorization code from provider",
            "examples": {
              "default": {
                "value": "def50200..."
              }
            }
          },
          {
            "name": "state",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "OAuth state parameter for CSRF protection"
          },
          {
            "name": "error",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Error code if authentication failed",
            "examples": {
              "default": {
                "value": "access_denied"
              }
            }
          },
          {
            "name": "error_description",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Human-readable error description"
          }
        ],
        "responses": {
          "302": {
            "description": "Redirect after processing callback",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "Redirect URL - success goes to callbackUrl, error goes to error page"
              }
            }
          }
        }
      }
    },
    "/api/auth/session": {
      "get": {
        "summary": "Get current session",
        "description": "Retrieve the current user's session information including user profile and authentication status",
        "tags": [
          "Authentication"
        ],
        "responses": {
          "200": {
            "description": "Current session information",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "properties": {
                        "user": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string",
                              "description": "NextAuth user ID"
                            },
                            "dbId": {
                              "type": "string",
                              "format": "uuid",
                              "description": "Database user ID"
                            },
                            "email": {
                              "type": "string",
                              "format": "email"
                            },
                            "name": {
                              "type": "string"
                            },
                            "image": {
                              "type": [
                                "string",
                                "null"
                              ],
                              "format": "uri"
                            }
                          }
                        },
                        "expires": {
                          "type": "string",
                          "format": "date-time",
                          "description": "Session expiration time"
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {},
                      "description": "Empty object if not authenticated"
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/csrf": {
      "get": {
        "summary": "Get CSRF token",
        "description": "Retrieve CSRF token for form submissions to NextAuth endpoints",
        "tags": [
          "Authentication"
        ],
        "responses": {
          "200": {
            "description": "CSRF token",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "csrfToken": {
                      "type": "string",
                      "description": "CSRF protection token"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/providers": {
      "get": {
        "summary": "Get authentication providers",
        "description": "Retrieve list of configured authentication providers",
        "tags": [
          "Authentication"
        ],
        "responses": {
          "200": {
            "description": "Available authentication providers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "examples": [
                          "keycloak"
                        ]
                      },
                      "name": {
                        "type": "string",
                        "examples": [
                          "Keycloak"
                        ]
                      },
                      "type": {
                        "type": "string",
                        "examples": [
                          "oauth"
                        ]
                      },
                      "signinUrl": {
                        "type": "string",
                        "format": "uri"
                      },
                      "callbackUrl": {
                        "type": "string",
                        "format": "uri"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/validate-token": {
      "get": {
        "summary": "Validate token with middleware protection",
        "description": "Validate a token and return token information using dual authentication middleware. Supports permission checking for specific workspaces.",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "permission",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Specific permission to check (e.g., 'fragments.read', 'workspace.update')",
            "examples": {
              "default": {
                "value": "fragments.read"
              }
            }
          },
          {
            "name": "workspaceId",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID for permission checking",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Token validation successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "valid": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "token": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "name": {
                          "type": "string",
                          "examples": [
                            "MCP Server Production"
                          ]
                        },
                        "workspacePermissions": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/WorkspacePermission"
                          }
                        },
                        "globalPermissions": {
                          "$ref": "#/components/schemas/GlobalPermissions"
                        },
                        "expiresAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        },
                        "lastUsedAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        },
                        "isRevoked": {
                          "type": "boolean"
                        }
                      }
                    },
                    "permissionCheck": {
                      "type": [
                        "object",
                        "null"
                      ],
                      "description": "Permission check result if permission parameter provided",
                      "properties": {
                        "hasPermission": {
                          "type": "boolean"
                        },
                        "reason": {
                          "type": "string"
                        }
                      }
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Token is valid and authenticated"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "No token provided",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "No token provided"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Manual token validation",
        "description": "Validate a token directly without middleware protection. Useful for testing token validation logic.",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Token validation successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "valid": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "token": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "name": {
                          "type": "string",
                          "examples": [
                            "MCP Server Production"
                          ]
                        },
                        "workspacePermissions": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/WorkspacePermission"
                          }
                        },
                        "globalPermissions": {
                          "$ref": "#/components/schemas/GlobalPermissions"
                        },
                        "expiresAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        },
                        "lastUsedAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        },
                        "isRevoked": {
                          "type": "boolean"
                        }
                      }
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Token validation successful"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Token validation failed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "valid": {
                      "type": "boolean",
                      "examples": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string",
                      "examples": [
                        "Token expired"
                      ]
                    },
                    "errorType": {
                      "type": "string",
                      "examples": [
                        "EXPIRED_TOKEN"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "valid": {
                      "type": "boolean",
                      "examples": [
                        false
                      ]
                    },
                    "error": {
                      "type": "string",
                      "examples": [
                        "Validation failed"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/tokens": {
      "get": {
        "summary": "Get personal access tokens",
        "description": "Retrieve all personal access tokens for the authenticated user",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of user's tokens",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "tokens": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/PersonalAccessToken"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Create personal access token",
        "description": "Generate a new personal access token for MCP server integration",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "workspacePermissions"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 255,
                    "description": "Human-readable name for the token",
                    "examples": [
                      "MCP Server Production"
                    ]
                  },
                  "workspacePermissions": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/WorkspacePermission"
                    }
                  },
                  "globalPermissions": {
                    "$ref": "#/components/schemas/GlobalPermissions"
                  },
                  "expiresAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Optional expiration date"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Token created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "tokenId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "token": {
                      "type": "string",
                      "description": "Store securely!"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/memory-fragments": {
      "get": {
        "summary": "Get memory fragments",
        "description": "Retrieve memory fragments with filtering and pagination from a specific workspace",
        "tags": [
          "Memory Fragments"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID to retrieve fragments from (required)"
          },
          {
            "name": "id",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Optional: filter by a specific fragment ID (takes precedence over other filters)"
          },
          {
            "name": "fragmentTypeId",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Filter by fragment type ID"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "draft",
                "published",
                "archived"
              ]
            },
            "description": "Filter by fragment status"
          },
          {
            "name": "tags",
            "in": "query",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "description": "Filter by tags (can be specified multiple times)"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 5,
              "maximum": 500
            },
            "description": "Number of results to return (min 5, max 500)"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 0
            },
            "description": "Number of results to skip"
          }
        ],
        "responses": {
          "200": {
            "description": "Memory fragments retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fragments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/MemoryFragment"
                      }
                    },
                    "count": {
                      "type": "integer",
                      "description": "Number of fragments returned"
                    },
                    "filters": {
                      "type": "object",
                      "properties": {
                        "workspaceId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "fragmentTypeId": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "uuid"
                        },
                        "status": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "tags": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "id": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "uuid"
                        }
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "limit": {
                          "type": [
                            "integer",
                            "null"
                          ]
                        },
                        "offset": {
                          "type": [
                            "integer",
                            "null"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError"
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "Workspace not found or access denied"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Create memory fragment",
        "description": "Create a new memory fragment in a workspace with event-driven processing",
        "tags": [
          "Memory Fragments"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "workspaceId",
                  "fragmentTypeId",
                  "title",
                  "summary",
                  "content"
                ],
                "properties": {
                  "workspaceId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "ID of the workspace to create the fragment in"
                  },
                  "fragmentTypeId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "ID of the fragment type"
                  },
                  "title": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500,
                    "description": "Fragment title"
                  },
                  "summary": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Fragment summary (required)"
                  },
                  "content": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Fragment content (supports Markdown)"
                  },
                  "tags": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Optional tags for categorization"
                  },
                  "createdVia": {
                    "type": "string",
                    "enum": [
                      "web",
                      "mcp",
                      "api"
                    ],
                    "description": "How the fragment was created"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fragment creation initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fragmentId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Memory fragment creation initiated"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError",
            "description": "Invalid input data or invalid fragment type"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Insufficient permissions - only collaborators and owners can create fragments"
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "Workspace not found or access denied"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/memory-fragments/{id}": {
      "get": {
        "summary": "Get specific memory fragment",
        "description": "Retrieve a specific memory fragment by ID. User must have read access to the containing workspace.",
        "tags": [
          "Memory Fragments"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Memory fragment ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Memory fragment retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fragment": {
                      "$ref": "#/components/schemas/FragmentUpdate"
                    },
                    "userRole": {
                      "type": "string",
                      "enum": [
                        "owner",
                        "collaborator",
                        "viewer",
                        "subscriber"
                      ],
                      "description": "User's role in the workspace"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Memory fragment not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Memory fragment not found or access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "patch": {
        "summary": "Update memory fragment",
        "description": "Update a memory fragment. User must be owner or collaborator in the workspace.",
        "tags": [
          "Memory Fragments"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Memory fragment ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500,
                    "description": "Updated fragment title"
                  },
                  "summary": {
                    "type": "string",
                    "description": "Updated fragment summary"
                  },
                  "content": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Updated fragment content (Markdown supported)"
                  },
                  "tags": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Updated tags array"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "published",
                      "archived"
                    ],
                    "description": "Updated fragment status"
                  },
                  "metadata": {
                    "type": "object",
                    "properties": {
                      "repository": {
                        "type": "string"
                      },
                      "filePaths": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "language": {
                        "type": "string"
                      },
                      "difficulty": {
                        "type": "string",
                        "enum": [
                          "beginner",
                          "intermediate",
                          "advanced"
                        ]
                      },
                      "estimatedTime": {
                        "type": "number"
                      },
                      "dependencies": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "version": {
                        "type": "string"
                      },
                      "lastTested": {
                        "type": "string",
                        "format": "date-time"
                      }
                    },
                    "description": "Optional metadata for the fragment"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fragment update initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fragmentId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Memory fragment update initiated"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid input"
                      ]
                    },
                    "details": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "field": {
                            "type": "string"
                          },
                          "message": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Insufficient permissions to edit fragment",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Insufficient permissions to edit this memory fragment"
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Memory fragment not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Memory fragment not found or access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete or archive memory fragment",
        "description": "Delete or archive a memory fragment. User must be owner or collaborator (for own fragments) in the workspace.",
        "tags": [
          "Memory Fragments"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Memory fragment ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "reason": {
                    "type": "string",
                    "description": "Optional reason for deletion/archival"
                  },
                  "archive": {
                    "type": "boolean",
                    "description": "If true, archive instead of delete",
                    "default": false
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fragment deletion/archival initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fragmentId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "processing"
                      ]
                    },
                    "action": {
                      "type": "string",
                      "enum": [
                        "deleted",
                        "archived"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Memory fragment deletion initiated"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid input"
                      ]
                    },
                    "details": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "field": {
                            "type": "string"
                          },
                          "message": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Insufficient permissions to delete fragment",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Insufficient permissions to delete this memory fragment"
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Memory fragment not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Memory fragment not found or access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/memory-fragments/check-limits": {
      "post": {
        "summary": "Check fragment creation limits",
        "description": "Check if user can create a memory fragment based on AI token limits and workspace permissions.",
        "tags": [
          "Memory Fragments"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "workspaceId",
                  "summary"
                ],
                "properties": {
                  "workspaceId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "Workspace ID where fragment will be created"
                  },
                  "summary": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Fragment summary for token estimation"
                  },
                  "tags": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Optional tags for token estimation"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Limit check completed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "canCreate": {
                      "type": "boolean",
                      "description": "Whether user can create the fragment"
                    },
                    "limitInfo": {
                      "type": "object",
                      "properties": {
                        "tierName": {
                          "type": "string",
                          "examples": [
                            "free"
                          ]
                        },
                        "tokensNeeded": {
                          "type": "integer",
                          "examples": [
                            150
                          ]
                        },
                        "tokensUsed": {
                          "type": "integer",
                          "examples": [
                            1200
                          ]
                        },
                        "tokensLimit": {
                          "type": "integer",
                          "examples": [
                            5000
                          ]
                        },
                        "tokensRemaining": {
                          "type": "integer",
                          "examples": [
                            3800
                          ]
                        },
                        "estimatedCostCents": {
                          "type": "number",
                          "examples": [
                            0.03
                          ]
                        }
                      }
                    },
                    "error": {
                      "type": [
                        "string",
                        "null"
                      ],
                      "description": "Error message if creation not allowed"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid input"
                      ]
                    },
                    "details": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "field": {
                            "type": "string"
                          },
                          "message": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Insufficient permissions to create fragments",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Insufficient permissions to create fragments"
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Workspace not found or access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces": {
      "get": {
        "summary": "Get user workspaces",
        "description": "Retrieve workspaces the user has access to (member and subscribed workspaces)",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of accessible workspaces",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "workspaces": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Workspace"
                      },
                      "description": "Combined list of member and subscribed workspaces"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Create workspace",
        "description": "Create a new workspace. User becomes the owner with full permissions.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 255,
                    "description": "Workspace name",
                    "examples": [
                      "Development Team"
                    ]
                  },
                  "description": {
                    "type": "string",
                    "description": "Optional workspace description",
                    "examples": [
                      "A workspace for our development team collaboration"
                    ]
                  },
                  "visibility": {
                    "type": "string",
                    "enum": [
                      "private",
                      "public"
                    ],
                    "default": "private",
                    "description": "Workspace visibility setting"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Workspace creation initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "workspaceId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Workspace creation initiated successfully!"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid data"
                      ]
                    },
                    "details": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "field": {
                            "type": "string"
                          },
                          "message": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/accessible": {
      "get": {
        "summary": "Get accessible workspaces",
        "description": "Get all workspaces that the user has access to, primarily used for token creation and permission management.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of accessible workspaces",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaces": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Workspace"
                      },
                      "description": "Workspaces accessible to the user"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/discover": {
      "get": {
        "summary": "Discover public workspaces",
        "description": "Get public workspaces available for subscription, excluding those the user is already a member of.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of discoverable public workspaces",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaces": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Workspace"
                      },
                      "description": "Public workspaces available for subscription"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "description": "Failed to fetch public workspaces",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Failed to fetch public workspaces"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/workspaces/{id}": {
      "get": {
        "summary": "Get specific workspace",
        "description": "Retrieve details for a specific workspace. User must have access to the workspace.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Workspace details retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "workspace": {
                      "allOf": [
                        {
                          "$ref": "#/components/schemas/Workspace"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "userRole": {
                              "type": "string",
                              "enum": [
                                "owner",
                                "collaborator",
                                "viewer",
                                "subscriber"
                              ],
                              "description": "User's role in this workspace"
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Workspace not found or access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "put": {
        "summary": "Update workspace",
        "description": "Update workspace settings. Only workspace owners can update workspace settings.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 255,
                    "description": "Updated workspace name"
                  },
                  "description": {
                    "type": "string",
                    "description": "Updated workspace description"
                  },
                  "visibility": {
                    "type": "string",
                    "enum": [
                      "private",
                      "public"
                    ],
                    "description": "Updated visibility setting"
                  },
                  "settings": {
                    "type": "object",
                    "properties": {
                      "allowGuestAccess": {
                        "type": "boolean",
                        "description": "Allow guest access to the workspace"
                      },
                      "defaultMemberRole": {
                        "type": "string",
                        "enum": [
                          "viewer",
                          "collaborator"
                        ],
                        "description": "Default role for new members"
                      }
                    },
                    "description": "Workspace settings"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Workspace update initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "workspaceId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Workspace update initiated"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid input"
                      ]
                    },
                    "details": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "field": {
                            "type": "string"
                          },
                          "message": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Only workspace owners can update settings",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Only workspace owners can update workspace settings"
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Workspace not found or access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Archive workspace",
        "description": "Archive (soft delete) a workspace. Only workspace owners can archive workspaces. This is a permanent action that archives all contained fragments.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Workspace archive initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "workspaceId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Workspace archive initiated"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Only workspace owners can delete workspaces",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Only workspace owners can delete workspaces"
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Workspace not found or access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{id}/settings": {
      "get": {
        "summary": "Get workspace settings",
        "description": "Retrieve workspace settings including concept evolution and tag aliases.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Workspace settings retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WorkspaceSettingsResponse"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "patch": {
        "summary": "Update workspace settings",
        "description": "Update concept evolution and tag alias settings. Event-driven: emits workspace.updated event.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateWorkspaceSettingsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Workspace settings update initiated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Workspace settings update initiated"
                      ]
                    },
                    "settings": {
                      "$ref": "#/components/schemas/WorkspaceSettings"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{id}/subscribe": {
      "post": {
        "summary": "Subscribe to public workspace",
        "description": "Subscribe to a public workspace to get read-only access. User will be able to view and search fragments but not create or edit them.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully subscribed to workspace",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "subscriptionId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Successfully subscribed to workspace"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Workspace not found or not public",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Workspace not found or not available for subscription"
                      ]
                    }
                  }
                }
              }
            }
          },
          "409": {
            "description": "Already subscribed or member",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Already subscribed to this workspace or already a member"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Failed to subscribe to workspace",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Failed to subscribe to workspace"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/workspaces/{id}/unsubscribe": {
      "post": {
        "summary": "Unsubscribe from workspace",
        "description": "Unsubscribe from a workspace that user was previously subscribed to. This removes read-only access to the workspace.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID",
            "examples": {
              "default": {
                "value": "550e8400-e29b-41d4-a716-446655440000"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully unsubscribed from workspace",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "subscriptionId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Successfully unsubscribed from workspace"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Workspace not found or not subscribed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Not subscribed to this workspace or workspace not found"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Failed to unsubscribe from workspace",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Failed to unsubscribe from workspace"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/workspaces/{id}/mcp-system-prompt": {
      "get": {
        "summary": "Generate MCP system prompt",
        "description": "Generate a Model Context Protocol system prompt for a specific workspace, including fragment types and workspace information. Used by MCP servers to integrate with workspace-specific knowledge.",
        "tags": [
          "MCP Integration",
          "Workspaces"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "UUID of the workspace to generate system prompt for",
            "examples": {
              "default": {
                "value": "60c10ca2-4115-4c1a-b6d7-04ac39fd3938"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "System prompt generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "systemPrompt": {
                      "type": "string",
                      "description": "Generated MCP system prompt with workspace context",
                      "examples": [
                        "# Usable MCP Integration\n\nRepository: alminni\nWorkspaceId: 60c10ca2-4115-4c1a-b6d7-04ac39fd3938\nWorkspace: My Workspace\nWorkspace Fragment Types: knowledge, recipe, solution, template\n\n## Fragment Type Mapping\n\n- **Knowledge**: `04a5fb62-1ba5-436c-acf7-f65f3a5ba6f6`\n- **Recipe**: `502a2fcf-ca6f-4b8a-b719-cd50469d3be6`\n..."
                      ]
                    },
                    "workspaceId": {
                      "type": "string",
                      "format": "uuid",
                      "description": "The workspace ID used to generate the prompt"
                    },
                    "workspaceName": {
                      "type": "string",
                      "description": "Name of the workspace"
                    },
                    "fragmentTypes": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "name": {
                            "type": "string"
                          },
                          "description": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "icon": {
                            "type": "string"
                          },
                          "color": {
                            "type": "string"
                          },
                          "isSystemDefault": {
                            "type": "boolean"
                          }
                        }
                      },
                      "description": "Available fragment types in the workspace"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid workspace ID",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid workspace ID"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Access denied - insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Workspace not found or access denied"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/search": {
      "get": {
        "summary": "Search memory fragments",
        "description": "Semantic search across memory fragments using vector embeddings",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "description": "Search query"
          },
          {
            "name": "workspaceIds",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Comma-separated workspace IDs to search in"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResult"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/search/global": {
      "get": {
        "summary": "Global search across accessible workspaces",
        "description": "Search across all workspaces the user has access to including workspaces, fragments, and fragment types",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "description": "Search query"
          },
          {
            "name": "sortBy",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "relevance",
                "date",
                "name",
                "fragments"
              ],
              "default": "relevance"
            },
            "description": "Sort results by relevance, date, name, or fragment count"
          },
          {
            "name": "sortDirection",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "Sort direction"
          },
          {
            "name": "filterType",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "all",
                "workspaces",
                "fragments",
                "types"
              ],
              "default": "all"
            },
            "description": "Filter results by type"
          }
        ],
        "responses": {
          "200": {
            "description": "Global search results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaces": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Workspace"
                      }
                    },
                    "fragments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/MemoryFragment"
                      }
                    },
                    "fragmentTypes": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/FragmentType"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/search/saved": {
      "get": {
        "summary": "Get saved searches",
        "description": "Retrieve saved search queries for a specific workspace",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID of the workspace to get saved searches for"
          }
        ],
        "responses": {
          "200": {
            "description": "List of saved searches",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "savedSearches": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/SavedSearch"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Save search query",
        "description": "Save a search query with filters for future use",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "workspaceId",
                  "name"
                ],
                "properties": {
                  "workspaceId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "ID of the workspace"
                  },
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 255,
                    "description": "Display name for the saved search"
                  },
                  "query": {
                    "type": "string",
                    "description": "Search query text"
                  },
                  "filters": {
                    "type": "object",
                    "properties": {
                      "fragmentTypeIds": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "description": "Filter by fragment type IDs"
                      },
                      "tags": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "description": "Filter by tags"
                      },
                      "authors": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "description": "Filter by author user IDs"
                      },
                      "dateRange": {
                        "type": "object",
                        "properties": {
                          "from": {
                            "type": "string",
                            "format": "date"
                          },
                          "to": {
                            "type": "string",
                            "format": "date"
                          }
                        },
                        "description": "Date range filter"
                      },
                      "createdVia": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "enum": [
                            "web",
                            "mcp",
                            "api"
                          ]
                        },
                        "description": "Filter by creation method"
                      }
                    },
                    "description": "Search filters to save"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search saved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "savedSearch": {
                      "$ref": "#/components/schemas/SavedSearch"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete saved search",
        "description": "Delete a saved search query by ID",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "savedSearchId"
                ],
                "properties": {
                  "savedSearchId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "ID of the saved search to delete"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Saved search deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Saved search deleted successfully"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Saved search not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/search/analytics": {
      "get": {
        "summary": "Get search analytics",
        "description": "Get comprehensive search analytics for a workspace including query trends and popular searches",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID of the workspace to get analytics for"
          },
          {
            "name": "dateFrom",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "Start date for analytics range"
          },
          {
            "name": "dateTo",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "End date for analytics range"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 50,
              "default": 10
            },
            "description": "Maximum number of top queries to return"
          }
        ],
        "responses": {
          "200": {
            "description": "Search analytics data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "analytics": {
                      "type": "object",
                      "properties": {
                        "totalSearches": {
                          "type": "integer",
                          "description": "Total number of searches performed"
                        },
                        "uniqueQueries": {
                          "type": "integer",
                          "description": "Number of unique search queries"
                        },
                        "averageResultsPerSearch": {
                          "type": "integer",
                          "description": "Average number of results per search"
                        },
                        "topQueries": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "query": {
                                "type": "string"
                              },
                              "count": {
                                "type": "integer"
                              },
                              "avgResults": {
                                "type": "number"
                              }
                            }
                          }
                        },
                        "searchTrends": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "date": {
                                "type": "string",
                                "format": "date"
                              },
                              "count": {
                                "type": "integer"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/search/suggestions": {
      "get": {
        "summary": "Get search suggestions",
        "description": "Get autocomplete suggestions for search queries based on previous searches and popular queries",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID of the workspace to get suggestions for"
          },
          {
            "name": "query",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "description": "Partial search query to get suggestions for"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 20,
              "default": 10
            },
            "description": "Maximum number of suggestions to return"
          }
        ],
        "responses": {
          "200": {
            "description": "Search suggestions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "suggestions": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "List of suggested search queries"
                    },
                    "popularQueries": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "List of popular search queries"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/users": {
      "get": {
        "summary": "Get users (Admin only)",
        "description": "Retrieve a list of users with optional search and filtering. Requires admin privileges.",
        "tags": [
          "Users",
          "Admin"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Search query for user name or email"
          },
          {
            "name": "role",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "admin",
                "super_admin",
                "user",
                "collaborator",
                "viewer"
              ]
            },
            "description": "Filter by user role"
          },
          {
            "name": "isActive",
            "in": "query",
            "schema": {
              "type": "boolean"
            },
            "description": "Filter by active status"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10
            },
            "description": "Maximum number of users to return"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Number of users to skip for pagination"
          }
        ],
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/User"
                      }
                    },
                    "total": {
                      "type": "integer",
                      "description": "Total number of users matching the query"
                    },
                    "limit": {
                      "type": "integer"
                    },
                    "offset": {
                      "type": "integer"
                    },
                    "hasMore": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Create user (Admin only)",
        "description": "Create a new user account. Requires admin privileges. Uses event-driven processing.",
        "tags": [
          "Users",
          "Admin"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "firstName",
                  "lastName",
                  "email"
                ],
                "properties": {
                  "firstName": {
                    "type": "string",
                    "minLength": 1,
                    "description": "User's first name"
                  },
                  "lastName": {
                    "type": "string",
                    "minLength": 1,
                    "description": "User's last name"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "User's email address"
                  },
                  "company": {
                    "type": "string",
                    "description": "User's company name"
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "admin",
                      "collaborator",
                      "viewer"
                    ],
                    "default": "viewer",
                    "description": "User's global role"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User creation initiated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "userId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "eventId": {
                      "type": "string"
                    },
                    "sessionId": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "User creation initiated"
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/profile/analytics": {
      "get": {
        "summary": "Get user profile analytics",
        "description": "Get comprehensive analytics for the authenticated user including storage usage, embedding usage, and billing information",
        "tags": [
          "Profile",
          "Analytics"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User analytics data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserAnalyticsSummary"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/subscription": {
      "get": {
        "summary": "Get subscription information",
        "description": "Get current subscription tier and usage information for the authenticated user",
        "tags": [
          "Subscription"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Subscription information",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserSubscriptionInfo"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/subscription/tiers": {
      "get": {
        "summary": "Get available subscription tiers",
        "description": "Get all available subscription tiers with pricing and features",
        "tags": [
          "Subscription"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Available subscription tiers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "tiers": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/SubscriptionTier"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/subscription/change-tier": {
      "post": {
        "summary": "Change subscription tier",
        "description": "Upgrade or change the user's subscription tier with payment setup if required",
        "tags": [
          "Subscription"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "tierName"
                ],
                "properties": {
                  "tierName": {
                    "type": "string",
                    "enum": [
                      "free",
                      "starter",
                      "pro",
                      "enterprise"
                    ],
                    "description": "Target subscription tier"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Tier change initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "tierName": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string"
                        },
                        "subscriptionId": {
                          "type": "string"
                        },
                        "customerId": {
                          "type": "string"
                        },
                        "customerCreated": {
                          "type": "boolean"
                        },
                        "clientSecret": {
                          "type": "string",
                          "description": "Stripe payment confirmation client secret"
                        },
                        "setupIntentSecret": {
                          "type": "string",
                          "description": "Stripe setup intent secret for payment method setup"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/subscription/confirm-payment": {
      "post": {
        "summary": "Confirm payment and activate subscription",
        "description": "Confirm payment method setup and activate the subscription after successful payment verification",
        "tags": [
          "Subscription",
          "Payment"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "setupIntentId",
                  "tierName"
                ],
                "properties": {
                  "setupIntentId": {
                    "type": "string",
                    "description": "Stripe setup intent ID after payment method setup"
                  },
                  "tierName": {
                    "type": "string",
                    "enum": [
                      "starter",
                      "pro",
                      "enterprise"
                    ],
                    "description": "Target subscription tier (must be paid tier)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment confirmed and subscription activated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Payment confirmed and subscription created successfully"
                      ]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "subscriptionId": {
                          "type": "string",
                          "description": "Stripe subscription ID"
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "requires_payment_method",
                            "requires_confirmation",
                            "active",
                            "processing"
                          ],
                          "description": "Subscription status"
                        },
                        "tierName": {
                          "type": "string",
                          "description": "Activated subscription tier"
                        },
                        "clientSecret": {
                          "type": "string",
                          "description": "Client secret for additional confirmation if needed (3D Secure, etc.)"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Payment confirmation failed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "details": {
                      "type": "string",
                      "examples": [
                        "Payment confirmation failed"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Customer mismatch or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Customer mismatch"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/admin/customers": {
      "get": {
        "summary": "List all customers",
        "description": "Get paginated list of all customers with subscription and usage information",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            },
            "description": "Page number"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            },
            "description": "Items per page"
          },
          {
            "in": "query",
            "name": "tierName",
            "schema": {
              "type": "string",
              "enum": [
                "free",
                "starter",
                "pro",
                "enterprise"
              ]
            },
            "description": "Filter by subscription tier"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "trialing",
                "past_due",
                "canceled",
                "unpaid"
              ]
            },
            "description": "Filter by subscription status"
          },
          {
            "name": "dateFrom",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "Filter customers created after this date"
          },
          {
            "name": "dateTo",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "Filter customers created before this date"
          },
          {
            "name": "sortBy",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "createdAt",
                "name",
                "email",
                "totalRevenue",
                "lastActivity"
              ],
              "default": "createdAt"
            },
            "description": "Sort customers by field"
          },
          {
            "name": "sortDirection",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "Sort direction"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 25
            },
            "description": "Maximum number of customers to return"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Number of customers to skip for pagination"
          }
        ],
        "responses": {
          "200": {
            "description": "Customer list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "customers": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/AdminCustomer"
                      }
                    },
                    "total": {
                      "type": "integer"
                    },
                    "limit": {
                      "type": "integer"
                    },
                    "offset": {
                      "type": "integer"
                    },
                    "hasMore": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Super admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/admin/customers/export": {
      "get": {
        "summary": "Export customer data (Admin only)",
        "description": "Export customer data as CSV file with comprehensive usage and billing information. Requires super admin privileges.",
        "tags": [
          "Admin",
          "Customers",
          "Export"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "format",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "csv",
                "json"
              ],
              "default": "csv"
            },
            "description": "Export format"
          },
          {
            "name": "dateFrom",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "Include customers created after this date"
          },
          {
            "name": "dateTo",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "Include customers created before this date"
          },
          {
            "name": "includeBilling",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": true
            },
            "description": "Include billing information in export"
          },
          {
            "name": "includeUsage",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": true
            },
            "description": "Include usage statistics in export"
          }
        ],
        "responses": {
          "200": {
            "description": "Customer data export",
            "content": {
              "text/csv": {
                "schema": {
                  "type": "string",
                  "contentMediaType": "application/octet-stream"
                }
              },
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "customers": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/AdminCustomerExport"
                      }
                    },
                    "exportedAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "totalRecords": {
                      "type": "integer"
                    }
                  }
                }
              }
            },
            "headers": {
              "Content-Disposition": {
                "description": "Attachment filename",
                "schema": {
                  "type": "string",
                  "examples": [
                    "attachment; filename=customers-export-2024-01-01.csv"
                  ]
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Super admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/admin/customers/{customerId}": {
      "get": {
        "summary": "Get specific customer (Admin only)",
        "description": "Get comprehensive information about a specific customer including billing history and usage statistics. Requires super admin privileges.",
        "tags": [
          "Admin",
          "Customers"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "customerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Customer UUID"
          }
        ],
        "responses": {
          "200": {
            "description": "Customer details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminCustomerDetail"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Super admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Customer not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/admin/customers/{customerId}/profile": {
      "get": {
        "summary": "Get customer profile (Admin only)",
        "description": "Get detailed customer profile information including personal information, preferences, and account settings. Requires super admin privileges.",
        "tags": [
          "Admin",
          "Customers",
          "Profile"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "customerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Customer UUID"
          }
        ],
        "responses": {
          "200": {
            "description": "Customer profile",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "profile": {
                      "$ref": "#/components/schemas/AdminCustomerProfile"
                    },
                    "activityLog": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "timestamp": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "action": {
                            "type": "string"
                          },
                          "details": {
                            "type": "string"
                          },
                          "ipAddress": {
                            "type": "string"
                          },
                          "userAgent": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Super admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Customer not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/admin/customers/{customerId}/subscription": {
      "get": {
        "summary": "Get customer subscription (Admin only)",
        "description": "Get detailed subscription information including billing history, usage records, and payment methods. Requires super admin privileges.",
        "tags": [
          "Admin",
          "Customers",
          "Subscription"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "customerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Customer UUID"
          },
          {
            "name": "includeBillingHistory",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": true
            },
            "description": "Include full billing history"
          },
          {
            "name": "includeUsageRecords",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": true
            },
            "description": "Include usage records"
          }
        ],
        "responses": {
          "200": {
            "description": "Customer subscription details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminCustomerSubscription"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Super admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Customer not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/admin/customers/{customerId}/billing/credit": {
      "post": {
        "summary": "Add billing credit (Admin only)",
        "description": "Add billing credit to customer account for refunds, adjustments, or promotional credits. Requires super admin privileges. Creates an audit trail event.",
        "tags": [
          "Admin",
          "Customers",
          "Billing"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "customerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Customer UUID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "amountCents",
                  "reason"
                ],
                "properties": {
                  "amountCents": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Credit amount in cents (e.g., 1500 for $15.00)"
                  },
                  "reason": {
                    "type": "string",
                    "enum": [
                      "refund",
                      "adjustment",
                      "promotional",
                      "goodwill",
                      "error_correction"
                    ],
                    "description": "Reason for the credit"
                  },
                  "description": {
                    "type": "string",
                    "maxLength": 500,
                    "description": "Optional detailed description of the credit"
                  },
                  "invoiceId": {
                    "type": "string",
                    "description": "Related invoice ID if applicable"
                  },
                  "expiresAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Optional expiration date for promotional credits"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Credit added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "Billing credit added successfully"
                      ]
                    },
                    "credit": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "customerId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "amountCents": {
                          "type": "integer"
                        },
                        "formattedAmount": {
                          "type": "string",
                          "examples": [
                            "$15.00"
                          ]
                        },
                        "reason": {
                          "type": "string"
                        },
                        "description": {
                          "type": "string"
                        },
                        "appliedAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "appliedByAdminId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "expiresAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Super admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Customer not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/admin/billing/process": {
      "get": {
        "summary": "Get billing processor status",
        "description": "Get current billing processor status and suggestions for processing periods",
        "tags": [
          "Admin",
          "Billing"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Billing processor status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "examples": [
                        "ready"
                      ]
                    },
                    "suggestions": {
                      "type": "object",
                      "properties": {
                        "currentMonth": {
                          "type": "object",
                          "properties": {
                            "year": {
                              "type": "number",
                              "examples": [
                                2024
                              ]
                            },
                            "month": {
                              "type": "number",
                              "examples": [
                                12
                              ]
                            },
                            "description": {
                              "type": "string",
                              "examples": [
                                "Process current month (2024-12)"
                              ]
                            }
                          }
                        },
                        "lastMonth": {
                          "type": "object",
                          "properties": {
                            "year": {
                              "type": "number",
                              "examples": [
                                2024
                              ]
                            },
                            "month": {
                              "type": "number",
                              "examples": [
                                11
                              ]
                            },
                            "description": {
                              "type": "string",
                              "examples": [
                                "Process last month (2024-11)"
                              ]
                            }
                          }
                        }
                      }
                    },
                    "notes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "examples": [
                        [
                          "Billing processing aggregates usage events and creates Stripe invoices for overage charges",
                          "Use dryRun: true to test calculations without creating actual invoices"
                        ]
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Process billing for overage charges",
        "description": "Trigger billing processing for a specific month to calculate and invoice overage charges. Only processes users with paid tiers (starter/pro).",
        "tags": [
          "Admin",
          "Billing"
        ],
        "security": [
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "year",
                  "month"
                ],
                "properties": {
                  "year": {
                    "type": "number",
                    "minimum": 2024,
                    "maximum": 2030,
                    "description": "The year to process billing for",
                    "examples": [
                      2024
                    ]
                  },
                  "month": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 12,
                    "description": "The month to process billing for (1-12)",
                    "examples": [
                      11
                    ]
                  },
                  "dryRun": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true, calculates billing but doesn't create actual Stripe invoices",
                    "examples": [
                      false
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Billing processing completed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "billingPeriodId": {
                          "type": "string",
                          "examples": [
                            "billing-2024-11"
                          ]
                        },
                        "usersProcessed": {
                          "type": "number",
                          "examples": [
                            45
                          ]
                        },
                        "totalOverageAmount": {
                          "type": "number",
                          "examples": [
                            127.5
                          ]
                        },
                        "stripeInvoicesCreated": {
                          "type": "number",
                          "examples": [
                            23
                          ]
                        },
                        "errors": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "examples": [
                            []
                          ]
                        }
                      }
                    },
                    "processingTimeMs": {
                      "type": "number",
                      "examples": [
                        15432
                      ]
                    },
                    "dryRun": {
                      "type": "boolean",
                      "examples": [
                        false
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid request data"
                      ]
                    },
                    "details": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "code": {
                            "type": "string"
                          },
                          "path": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "message": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/ai/embeddings": {
      "post": {
        "summary": "Generate text embeddings",
        "description": "Generate vector embeddings for text using OpenAI's text-embedding-3-large model with usage metering and billing",
        "tags": [
          "AI"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "text"
                ],
                "properties": {
                  "text": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 8000,
                    "description": "Text to generate embeddings for",
                    "examples": [
                      "This is a sample text for embedding generation"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Embedding generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "embedding": {
                      "type": "array",
                      "items": {
                        "type": "number"
                      },
                      "description": "Vector embedding array"
                    },
                    "model": {
                      "type": "string",
                      "examples": [
                        "text-embedding-3-large"
                      ]
                    },
                    "tokensUsed": {
                      "type": "integer",
                      "description": "Number of tokens used for this request"
                    },
                    "costCents": {
                      "type": "number",
                      "description": "Cost in cents (0 for free tier, calculated for paid tiers)"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "description": "Rate limit exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Monthly limit exceeded. 0 tokens remaining."
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/ai/embeddings/usage": {
      "get": {
        "summary": "Get embedding usage statistics",
        "description": "Get current monthly embedding usage, limits, and billing information for the authenticated user",
        "tags": [
          "AI"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Embedding usage statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "tokensUsed": {
                      "type": "integer",
                      "description": "Tokens used this month"
                    },
                    "tokensLimit": {
                      "type": "integer",
                      "description": "Monthly token limit (0 for unlimited)"
                    },
                    "tokensRemaining": {
                      "type": "integer",
                      "description": "Tokens remaining this month"
                    },
                    "costCents": {
                      "type": "number",
                      "description": "Total cost this month in cents"
                    },
                    "tierName": {
                      "type": "string",
                      "enum": [
                        "free",
                        "starter",
                        "pro",
                        "enterprise"
                      ],
                      "description": "User's current subscription tier"
                    },
                    "weekStart": {
                      "type": "string",
                      "format": "date",
                      "description": "Start of current billing month (kept for API compatibility)"
                    },
                    "isLimitExceeded": {
                      "type": "boolean",
                      "description": "Whether the monthly limit has been exceeded"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/ai/generate-summary": {
      "post": {
        "summary": "Generate AI summary for fragment",
        "description": "Generate an AI-powered summary for a memory fragment using OpenAI GPT models",
        "tags": [
          "AI"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "title",
                  "content"
                ],
                "properties": {
                  "title": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500,
                    "description": "Fragment title for context",
                    "examples": [
                      "How to implement JWT authentication"
                    ]
                  },
                  "content": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Fragment content to summarize",
                    "examples": [
                      "JWT (JSON Web Token) is a compact, URL-safe means of representing claims..."
                    ]
                  },
                  "fragmentType": {
                    "type": "string",
                    "description": "Optional fragment type for better context",
                    "examples": [
                      "Knowledge"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Summary generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "summary": {
                      "type": "string",
                      "description": "AI-generated summary of the content",
                      "examples": [
                        "A comprehensive guide to implementing JWT authentication, covering token structure, validation, and security best practices."
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid request data"
                      ]
                    },
                    "details": {
                      "type": "object",
                      "description": "Validation error details"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          },
          "503": {
            "description": "AI features not available",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "AI features are not available. OpenAI API key not configured."
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "Check AI summary generation availability",
        "description": "Check if AI summary generation is available (OpenAI configured)",
        "tags": [
          "AI"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "AI availability status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "available": {
                      "type": "boolean",
                      "description": "Whether AI summary generation is available"
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "AI summary generation is available"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/ai/generate-tags": {
      "post": {
        "summary": "Generate AI tags for fragment",
        "description": "Generate AI-powered tags for a memory fragment using OpenAI GPT models",
        "tags": [
          "AI"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "title",
                  "content"
                ],
                "properties": {
                  "title": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500,
                    "description": "Fragment title for context",
                    "examples": [
                      "How to implement JWT authentication"
                    ]
                  },
                  "content": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Fragment content to analyze for tags",
                    "examples": [
                      "JWT (JSON Web Token) is a compact, URL-safe means of representing claims..."
                    ]
                  },
                  "fragmentType": {
                    "type": "string",
                    "description": "Optional fragment type for better context",
                    "examples": [
                      "Knowledge"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Tags generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "tags": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "AI-generated tags for the content",
                      "examples": [
                        [
                          "jwt",
                          "authentication",
                          "security",
                          "tokens",
                          "api"
                        ]
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Invalid request data"
                      ]
                    },
                    "details": {
                      "type": "object",
                      "description": "Validation error details"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          },
          "503": {
            "description": "AI features not available",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "AI features are not available. OpenAI API key not configured."
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "Check AI tag generation availability",
        "description": "Check if AI tag generation is available (OpenAI configured)",
        "tags": [
          "AI"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "AI availability status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "available": {
                      "type": "boolean",
                      "description": "Whether AI tag generation is available"
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "AI tag generation is available"
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/mcp": {
      "get": {
        "summary": "MCP Server Info",
        "description": "Returns comprehensive information about the Usable MCP server including capabilities, tools, and endpoints when accessed via GET request",
        "tags": [
          "MCP Integration"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Comprehensive MCP server information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string",
                      "examples": [
                        "usable-server"
                      ]
                    },
                    "version": {
                      "type": "string",
                      "examples": [
                        "1.0.0"
                      ]
                    },
                    "description": {
                      "type": "string",
                      "examples": [
                        "Usable MCP Server - AI-powered memory fragment management"
                      ]
                    },
                    "protocolVersion": {
                      "type": "string",
                      "examples": [
                        "2024-11-05"
                      ]
                    },
                    "capabilities": {
                      "type": "object",
                      "properties": {
                        "tools": {
                          "type": "object",
                          "properties": {
                            "count": {
                              "type": "number",
                              "examples": [
                                14
                              ]
                            },
                            "list": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "name": {
                                    "type": "string"
                                  },
                                  "description": {
                                    "type": "string"
                                  }
                                }
                              },
                              "examples": [
                                [
                                  {
                                    "name": "agentic-search-fragments",
                                    "description": "Unified intelligent search with iterative expansion"
                                  },
                                  {
                                    "name": "create-memory-fragment",
                                    "description": "Create fragments with auto-classification"
                                  }
                                ]
                              ]
                            }
                          }
                        },
                        "features": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "examples": [
                            [
                              "AI-powered fragment classification",
                              "Semantic search with embeddings",
                              "Multi-workspace support",
                              "Real-time SSE notifications",
                              "Comprehensive error handling",
                              "Rate limiting",
                              "Performance monitoring"
                            ]
                          ]
                        }
                      }
                    },
                    "endpoints": {
                      "type": "object",
                      "properties": {
                        "jsonRpc": {
                          "type": "string",
                          "examples": [
                            "/api/mcp (POST)"
                          ]
                        },
                        "sse": {
                          "type": "string",
                          "examples": [
                            "/api/mcp (GET with Accept: text/event-stream)"
                          ]
                        },
                        "info": {
                          "type": "string",
                          "examples": [
                            "/api/mcp (GET)"
                          ]
                        }
                      }
                    },
                    "rateLimit": {
                      "type": "object",
                      "properties": {
                        "maxRequests": {
                          "type": "number",
                          "examples": [
                            100
                          ]
                        },
                        "windowMs": {
                          "type": "number",
                          "examples": [
                            60000
                          ]
                        }
                      }
                    },
                    "documentation": {
                      "type": "string",
                      "examples": [
                        "https://modelcontextprotocol.io/"
                      ]
                    },
                    "status": {
                      "type": "string",
                      "examples": [
                        "operational"
                      ]
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError"
          }
        }
      },
      "post": {
        "summary": "MCP JSON-RPC 2.0 Server",
        "description": "Model Context Protocol (MCP) server implementing JSON-RPC 2.0 for AI integration with Usable.\n\n**Protocol**: JSON-RPC 2.0 over HTTP\n**Authentication**: Bearer token with fragments.read and fragments.create permissions\n\n**Available Methods:**\n- `initialize` - Initialize MCP session\n- `tools/list` - Get available tools\n- `tools/call` - Execute a tool\n\n**Available Tools:**\n- `agentic-search-fragments` - ðŸš€ NEW: Unified intelligent search with iterative expansion\n- `create-memory-fragment` - Create fragments with auto-classification and tagging\n- `search-memory-fragments` - Advanced semantic search across workspaces (will be deprecated)\n- `get-memory-fragment-content` - Retrieve full fragment content by ID\n- `list-memory-fragments` - Metadata listing with SQL-like filtering (JSONB operators, nested queries, ORDER BY, aggregates)\n- `update-memory-fragment` - Update existing fragments with patch operations support\n- `list-workspaces` - List user's accessible workspaces with permissions\n- `get-fragment-types` - Get available fragment types for workspace\n\n**Required Token Permissions:**\n- `fragments.read` - Required for searching, listing, and graph exploration\n- `fragments.create` - Required for creating fragments",
        "tags": [
          "MCP Integration"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  {
                    "title": "Initialize Request",
                    "type": "object",
                    "properties": {
                      "jsonrpc": {
                        "type": "string",
                        "enum": [
                          "2.0"
                        ]
                      },
                      "method": {
                        "type": "string",
                        "enum": [
                          "initialize"
                        ]
                      },
                      "params": {
                        "type": "object",
                        "properties": {
                          "protocolVersion": {
                            "type": "string",
                            "examples": [
                              "2024-11-05"
                            ]
                          },
                          "capabilities": {
                            "type": "object"
                          },
                          "clientInfo": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string"
                              },
                              "version": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      },
                      "id": {
                        "type": [
                          "string",
                          "number",
                          "null"
                        ]
                      }
                    },
                    "required": [
                      "jsonrpc",
                      "method",
                      "id"
                    ]
                  },
                  {
                    "title": "Tools List Request",
                    "type": "object",
                    "properties": {
                      "jsonrpc": {
                        "type": "string",
                        "enum": [
                          "2.0"
                        ]
                      },
                      "method": {
                        "type": "string",
                        "enum": [
                          "tools/list"
                        ]
                      },
                      "id": {
                        "type": [
                          "string",
                          "number",
                          "null"
                        ]
                      }
                    },
                    "required": [
                      "jsonrpc",
                      "method",
                      "id"
                    ]
                  },
                  {
                    "title": "Tool Call Request",
                    "type": "object",
                    "properties": {
                      "jsonrpc": {
                        "type": "string",
                        "enum": [
                          "2.0"
                        ]
                      },
                      "method": {
                        "type": "string",
                        "enum": [
                          "tools/call"
                        ]
                      },
                      "params": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "enum": [
                              "agentic-search-fragments",
                              "create-memory-fragment",
                              "search-memory-fragments",
                              "get-memory-fragment-content",
                              "list-memory-fragments",
                              "update-memory-fragment",
                              "list-workspaces",
                              "get-fragment-types"
                            ]
                          },
                          "arguments": {
                            "type": "object",
                            "description": "Tool-specific arguments based on the tool being called"
                          }
                        },
                        "required": [
                          "name"
                        ]
                      },
                      "id": {
                        "type": [
                          "string",
                          "number",
                          "null"
                        ]
                      }
                    },
                    "required": [
                      "jsonrpc",
                      "method",
                      "params",
                      "id"
                    ]
                  }
                ]
              },
              "examples": {
                "Initialize": {
                  "summary": "Initialize MCP session",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "initialize",
                    "params": {
                      "protocolVersion": "2024-11-05",
                      "capabilities": {},
                      "clientInfo": {
                        "name": "example-client",
                        "version": "1.0.0"
                      }
                    },
                    "id": 1
                  }
                },
                "List Tools": {
                  "summary": "Get available tools",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/list",
                    "id": 2
                  }
                },
                "Create Fragment": {
                  "summary": "Create a memory fragment",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/call",
                    "params": {
                      "name": "create-memory-fragment",
                      "arguments": {
                        "workspaceId": "123e4567-e89b-12d3-a456-426614174000",
                        "title": "Docker Setup Guide",
                        "content": "# Docker Setup\n\nThis guide explains how to set up Docker for development...",
                        "summary": "Complete guide for Docker development setup",
                        "tags": [
                          "docker",
                          "development",
                          "guide"
                        ],
                        "repository": "api-service",
                        "branch": "main",
                        "fragmentType": "recipe"
                      }
                    },
                    "id": 3
                  }
                },
                "Search Fragments": {
                  "summary": "Search memory fragments",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/call",
                    "params": {
                      "name": "search-memory-fragments",
                      "arguments": {
                        "query": "docker setup",
                        "workspaceId": "123e4567-e89b-12d3-a456-426614174000",
                        "fragmentType": "recipe",
                        "tags": [
                          "docker"
                        ],
                        "limit": 10,
                        "useSemanticSearch": true
                      }
                    },
                    "id": 4
                  }
                },
                "Get Fragment Content": {
                  "summary": "Get full fragment content by ID",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/call",
                    "params": {
                      "name": "get-memory-fragment-content",
                      "arguments": {
                        "fragmentId": "456e7890-e12b-34d5-a678-901234567890"
                      }
                    },
                    "id": 5
                  }
                },
                "List Workspaces": {
                  "summary": "List accessible workspaces",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/call",
                    "params": {
                      "name": "list-workspaces",
                      "arguments": {
                        "includeArchived": false
                      }
                    },
                    "id": 6
                  }
                },
                "Agentic Search": {
                  "summary": "ðŸš€ NEW: Intelligent search with AI expansion",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/call",
                    "params": {
                      "name": "agentic-search-fragments",
                      "arguments": {
                        "query": "docker setup troubleshooting",
                        "workspaceId": "123e4567-e89b-12d3-a456-426614174000",
                        "limit": 10,
                        "outputFormat": "text",
                        "searchIntent": "Find comprehensive Docker setup and troubleshooting guides",
                        "tags": [
                          "docker"
                        ]
                      }
                    },
                    "id": 10
                  }
                },
                "Update Fragment": {
                  "summary": "Update existing fragment with patch operations",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/call",
                    "params": {
                      "name": "update-memory-fragment",
                      "arguments": {
                        "fragmentId": "456e7890-e12b-34d5-a678-901234567890",
                        "title": "Updated Docker Setup Guide",
                        "patchOperations": [
                          {
                            "type": "add",
                            "lineNumber": 1,
                            "lines": [
                              "# Updated Docker Setup Guide",
                              ""
                            ]
                          },
                          {
                            "type": "replace",
                            "searchText": "old command",
                            "replaceText": "docker compose up",
                            "replaceAll": false
                          }
                        ],
                        "outputFormat": "text"
                      }
                    },
                    "id": 11
                  }
                },
                "Get Fragment Types": {
                  "summary": "Get available fragment types for workspace",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/call",
                    "params": {
                      "name": "get-fragment-types",
                      "arguments": {
                        "workspaceId": "123e4567-e89b-12d3-a456-426614174000",
                        "outputFormat": "text"
                      }
                    },
                    "id": 12
                  }
                },
                "List Memory Fragments": {
                  "summary": "List fragments with traditional filtering",
                  "value": {
                    "jsonrpc": "2.0",
                    "method": "tools/call",
                    "params": {
                      "name": "list-memory-fragments",
                      "arguments": {
                        "workspaceId": "123e4567-e89b-12d3-a456-426614174000",
                        "fragmentTypeId": "04a5fb62-1ba5-436c-acf7-f65f3a5ba6f6",
                        "tags": [
                          "nextjs",
                          "api"
                        ],
                        "createdAfter": "2024-01-15T00:00:00Z",
                        "limit": 20,
                        "offset": 0,
                        "outputFormat": "json"
                      }
                    },
                    "id": 13
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "JSON-RPC 2.0 response",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "title": "Success Response",
                      "type": "object",
                      "properties": {
                        "jsonrpc": {
                          "type": "string",
                          "enum": [
                            "2.0"
                          ]
                        },
                        "result": {
                          "type": "object",
                          "description": "Method-specific result data"
                        },
                        "id": {
                          "type": [
                            "string",
                            "number",
                            "null"
                          ]
                        }
                      },
                      "required": [
                        "jsonrpc",
                        "result",
                        "id"
                      ]
                    },
                    {
                      "title": "Error Response",
                      "type": "object",
                      "properties": {
                        "jsonrpc": {
                          "type": "string",
                          "enum": [
                            "2.0"
                          ]
                        },
                        "error": {
                          "type": "object",
                          "properties": {
                            "code": {
                              "type": "integer"
                            },
                            "message": {
                              "type": "string"
                            },
                            "data": {
                              "type": "object"
                            }
                          },
                          "required": [
                            "code",
                            "message"
                          ]
                        },
                        "id": {
                          "type": [
                            "string",
                            "number",
                            "null"
                          ]
                        }
                      },
                      "required": [
                        "jsonrpc",
                        "error",
                        "id"
                      ]
                    }
                  ]
                },
                "examples": {
                  "Initialize Response": {
                    "summary": "Successful initialization",
                    "value": {
                      "jsonrpc": "2.0",
                      "result": {
                        "protocolVersion": "2024-11-05",
                        "capabilities": {
                          "tools": {}
                        },
                        "serverInfo": {
                          "name": "usable-server",
                          "version": "1.0.0"
                        }
                      },
                      "id": 1
                    }
                  },
                  "Tools List Response": {
                    "summary": "Available tools with full schemas",
                    "value": {
                      "jsonrpc": "2.0",
                      "result": {
                        "tools": [
                          {
                            "name": "agentic-search-fragments",
                            "description": "ðŸš€ NEW: Agentic search with iterative expansion: primes vector results and, when needed, expands in parallel via reformulated queries and graph starting-point exploration",
                            "inputSchema": {
                              "type": "object",
                              "properties": {
                                "query": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 2000,
                                  "description": "Natural-language query used to prime retrieval"
                                },
                                "context": {
                                  "type": "string",
                                  "maxLength": 3000,
                                  "description": "Optional additional context to guide relevance"
                                },
                                "searchIntent": {
                                  "type": "string",
                                  "maxLength": 1000,
                                  "description": "High-level objective used to bias selection and expansion steps"
                                },
                                "workspaceId": {
                                  "type": "string",
                                  "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
                                  "description": "Primary workspace scope"
                                },
                                "limit": {
                                  "type": "number",
                                  "minimum": 5,
                                  "maximum": 50,
                                  "default": 10,
                                  "description": "Number of fragments to return (5-50)"
                                },
                                "outputFormat": {
                                  "type": "string",
                                  "enum": [
                                    "text",
                                    "json"
                                  ],
                                  "default": "text",
                                  "description": "Response format"
                                }
                              },
                              "required": [
                                "query",
                                "limit",
                                "outputFormat"
                              ]
                            }
                          },
                          {
                            "name": "create-memory-fragment",
                            "description": "Create a new memory fragment in a workspace with AI-powered auto-classification and tagging",
                            "inputSchema": {
                              "type": "object",
                              "properties": {
                                "workspaceId": {
                                  "type": "string",
                                  "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
                                  "description": "UUID of the workspace to create the fragment in"
                                },
                                "title": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 500,
                                  "description": "Title of the memory fragment (1-500 characters)"
                                },
                                "content": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 50000,
                                  "description": "Content of the memory fragment (1-50,000 characters)"
                                },
                                "summary": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 1000,
                                  "description": "Brief summary of the fragment (1-1,000 characters)"
                                },
                                "tags": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "minLength": 1,
                                    "maxLength": 50,
                                    "pattern": "^[a-zA-Z0-9_:-]+$"
                                  },
                                  "maxItems": 20,
                                  "description": "Optional tags for the fragment (max 20 tags, alphanumeric + underscore/dash/colon only)"
                                },
                                "repository": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 100,
                                  "pattern": "^[a-zA-Z0-9_.-]+$",
                                  "description": "Repository context (e.g., 'api-service')"
                                },
                                "branch": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 100,
                                  "pattern": "^[a-zA-Z0-9_.-/]+$",
                                  "description": "Git branch context"
                                },
                                "fragmentTypeId": {
                                  "type": "string",
                                  "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
                                  "description": "Fragment type UUID, auto-classified if not provided"
                                }
                              },
                              "required": [
                                "workspaceId",
                                "title",
                                "content"
                              ]
                            }
                          },
                          {
                            "name": "search-memory-fragments",
                            "description": "Search for memory fragments using advanced chunked vector search with similarity scores for LLM re-ranking",
                            "inputSchema": {
                              "type": "object",
                              "properties": {
                                "query": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 500,
                                  "description": "Search query (1-500 characters)"
                                },
                                "workspaceId": {
                                  "type": "string",
                                  "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
                                  "description": "Optional workspace UUID to limit search scope"
                                },
                                "fragmentType": {
                                  "type": "string",
                                  "enum": [
                                    "knowledge",
                                    "recipe",
                                    "solution",
                                    "template"
                                  ],
                                  "description": "Optional fragment type filter"
                                },
                                "tags": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "minLength": 1,
                                    "maxLength": 50,
                                    "pattern": "^[a-zA-Z0-9_-]+$"
                                  },
                                  "maxItems": 10,
                                  "description": "Optional tags to filter by (max 10 tags)"
                                },
                                "limit": {
                                  "type": "number",
                                  "minimum": 1,
                                  "maximum": 50,
                                  "default": 10,
                                  "description": "Maximum number of results to return (1-50, default: 10)"
                                },
                                "useSemanticSearch": {
                                  "type": "boolean",
                                  "default": true,
                                  "description": "Enable AI-enhanced semantic search (default: true)"
                                },
                                "similarityThreshold": {
                                  "type": "integer",
                                  "minimum": 0,
                                  "maximum": 100,
                                  "description": "Minimum similarity score for semantic search results (0-100, default: 10)"
                                }
                              },
                              "required": [
                                "query"
                              ]
                            }
                          },
                          {
                            "name": "get-memory-fragment-content",
                            "description": "Get full content of a memory fragment by ID for detailed analysis and deep-dive access",
                            "inputSchema": {
                              "type": "object",
                              "properties": {
                                "fragmentId": {
                                  "type": "string",
                                  "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
                                  "description": "UUID of the memory fragment to retrieve"
                                }
                              },
                              "required": [
                                "fragmentId"
                              ]
                            }
                          },
                          {
                            "name": "list-workspaces",
                            "description": "List all accessible workspaces for the current user with role and permission information",
                            "inputSchema": {
                              "type": "object",
                              "properties": {
                                "includeArchived": {
                                  "type": "boolean",
                                  "default": false,
                                  "description": "Include archived workspaces in results (default: false)"
                                }
                              }
                            }
                          },
                          {
                            "name": "update-memory-fragment",
                            "description": "Update existing memory fragment content, metadata, tags, or status with support for precise patch operations",
                            "inputSchema": {
                              "type": "object",
                              "properties": {
                                "fragmentId": {
                                  "type": "string",
                                  "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
                                  "description": "UUID of the memory fragment to update"
                                },
                                "title": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 500,
                                  "description": "Updated title for the fragment"
                                },
                                "content": {
                                  "type": "string",
                                  "minLength": 1,
                                  "maxLength": 50000,
                                  "description": "Complete content replacement (cannot be used with patchOperations)"
                                },
                                "patchOperations": {
                                  "type": "array",
                                  "description": "Array of patch operations for precise content modifications",
                                  "items": {
                                    "anyOf": [
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "const": "add"
                                          },
                                          "lineNumber": {
                                            "type": "number",
                                            "minimum": 1
                                          },
                                          "lines": {
                                            "type": "array",
                                            "items": {
                                              "type": "string"
                                            }
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "lineNumber",
                                          "lines"
                                        ]
                                      },
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "const": "delete"
                                          },
                                          "startLine": {
                                            "type": "number",
                                            "minimum": 1
                                          },
                                          "endLine": {
                                            "type": "number",
                                            "minimum": 1
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "startLine",
                                          "endLine"
                                        ]
                                      },
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "const": "replace"
                                          },
                                          "searchText": {
                                            "type": "string",
                                            "minLength": 1
                                          },
                                          "replaceText": {
                                            "type": "string"
                                          },
                                          "replaceAll": {
                                            "type": "boolean",
                                            "default": false
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "searchText",
                                          "replaceText"
                                        ]
                                      }
                                    ]
                                  }
                                },
                                "outputFormat": {
                                  "type": "string",
                                  "enum": [
                                    "text",
                                    "json"
                                  ],
                                  "default": "text"
                                }
                              },
                              "required": [
                                "fragmentId",
                                "outputFormat"
                              ]
                            }
                          },
                          {
                            "name": "get-fragment-types",
                            "description": "Retrieve all available fragment types for a workspace including system defaults and custom types",
                            "inputSchema": {
                              "type": "object",
                              "properties": {
                                "workspaceId": {
                                  "type": "string",
                                  "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
                                  "description": "UUID of workspace to get fragment types for"
                                },
                                "outputFormat": {
                                  "type": "string",
                                  "enum": [
                                    "text",
                                    "json"
                                  ],
                                  "default": "text"
                                }
                              },
                              "required": [
                                "workspaceId",
                                "outputFormat"
                              ]
                            }
                          }
                        ]
                      },
                      "id": 2
                    }
                  },
                  "Fragment Created": {
                    "summary": "Fragment creation success",
                    "value": {
                      "jsonrpc": "2.0",
                      "result": {
                        "content": [
                          {
                            "type": "text",
                            "text": "Successfully created recipe fragment \"Docker Setup Guide\" in workspace \"Development Team\"\nFragment ID: 456e7890-e12b-34d5-a678-901234567890\nTags: docker, development, guide, repo:api-service, branch:main"
                          }
                        ]
                      },
                      "id": 3
                    }
                  },
                  "Search Results": {
                    "summary": "Fragment search results",
                    "value": {
                      "jsonrpc": "2.0",
                      "result": {
                        "content": [
                          {
                            "type": "text",
                            "text": "Found 2 fragments for \"docker setup\":\n\n1. **Docker Setup Guide** (Recipe)\nWorkspace: Development Team\nSummary: Complete guide for Docker development setup\nTags: docker, development, guide\nCreated: 1/15/2024\nAuthor: John Doe\n---\n\n2. **Docker Troubleshooting** (Solution)\nWorkspace: Development Team\nSummary: Common Docker issues and solutions\nTags: docker, troubleshooting\nCreated: 1/10/2024\nAuthor: Jane Smith\n---"
                          }
                        ]
                      },
                      "id": 4
                    }
                  },
                  "Fragment Content": {
                    "summary": "Full fragment content retrieval",
                    "value": {
                      "jsonrpc": "2.0",
                      "result": {
                        "content": [
                          {
                            "type": "text",
                            "text": "**Docker Setup Guide** (Recipe)\nWorkspace: Development Team\nFragment ID: 456e7890-e12b-34d5-a678-901234567890\nCreated: 1/15/2024 by John Doe\nTags: docker, development, guide, repo:api-service, branch:main\n\n---\n\n# Docker Setup\n\nThis guide explains how to set up Docker for development...\n\n## Prerequisites\n- Install Docker Desktop\n- Verify installation with `docker --version`\n\n## Configuration\n..."
                          }
                        ]
                      },
                      "id": 5
                    }
                  },
                  "Workspace List": {
                    "summary": "User's accessible workspaces",
                    "value": {
                      "jsonrpc": "2.0",
                      "result": {
                        "content": [
                          {
                            "type": "text",
                            "text": "Your accessible workspaces (2):\n\n1. **Development Team** (123e4567-e89b-12d3-a456-426614174000)\nRole: owner\nVisibility: private\nDescription: Main development workspace\nFragments: 45 | Members: 8\n---\n\n2. **Public Knowledge** (456e7890-e12b-34d5-a678-901234567890)\nRole: subscriber\nVisibility: public\nDescription: Community knowledge sharing\nFragments: 127 | Members: 23\n---"
                          }
                        ]
                      },
                      "id": 6
                    }
                  },
                  "Permission Error": {
                    "summary": "Insufficient permissions",
                    "value": {
                      "jsonrpc": "2.0",
                      "error": {
                        "code": -32003,
                        "message": "Forbidden - Missing required MCP permissions (fragments.read and fragments.create)"
                      },
                      "id": null
                    }
                  },
                  "Validation Error": {
                    "summary": "Invalid tool parameters",
                    "value": {
                      "jsonrpc": "2.0",
                      "error": {
                        "code": -32602,
                        "message": "Invalid params - workspaceId, title, and content are required"
                      },
                      "id": 3
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid JSON or malformed request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "jsonrpc": {
                      "type": "string",
                      "enum": [
                        "2.0"
                      ]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "integer",
                          "examples": [
                            -32700
                          ]
                        },
                        "message": {
                          "type": "string",
                          "examples": [
                            "Parse error - Invalid JSON"
                          ]
                        }
                      }
                    },
                    "id": {
                      "type": "null"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing API token",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "jsonrpc": {
                      "type": "string",
                      "enum": [
                        "2.0"
                      ]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "integer",
                          "examples": [
                            -32001
                          ]
                        },
                        "message": {
                          "type": "string",
                          "examples": [
                            "Unauthorized - Invalid or missing API token"
                          ]
                        }
                      }
                    },
                    "id": {
                      "type": "null"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "jsonrpc": {
                      "type": "string",
                      "enum": [
                        "2.0"
                      ]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "integer",
                          "examples": [
                            -32003
                          ]
                        },
                        "message": {
                          "type": "string",
                          "examples": [
                            "Forbidden - Missing required MCP permissions"
                          ]
                        }
                      }
                    },
                    "id": {
                      "type": "null"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/health": {
      "get": {
        "summary": "API health check",
        "description": "Check API status and availability",
        "tags": [
          "Health"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "API is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "examples": [
                        "healthy"
                      ]
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "version": {
                      "type": "string",
                      "examples": [
                        "1.4.0"
                      ]
                    },
                    "authenticated": {
                      "type": "boolean",
                      "description": "Whether the request was authenticated"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/version": {
      "get": {
        "summary": "Get application version",
        "description": "Returns the current application version with major version reduced by 1 (e.g., package.json '1.80.2' returns 'v0.80.2'). Supports cross-origin requests.",
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "Version retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "version": {
                      "type": "string",
                      "description": "Application version with major version reduced by 1",
                      "examples": [
                        "v0.80.2"
                      ]
                    },
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    }
                  }
                }
              }
            },
            "headers": {
              "Access-Control-Allow-Origin": {
                "description": "CORS header allowing all origins",
                "schema": {
                  "type": "string",
                  "examples": [
                    "*"
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "examples": [
                        "Failed to get version"
                      ]
                    },
                    "success": {
                      "type": "boolean",
                      "examples": [
                        false
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "options": {
        "summary": "CORS preflight for version endpoint",
        "description": "Handle CORS preflight requests for cross-origin access to version information",
        "tags": [
          "Health"
        ],
        "responses": {
          "204": {
            "description": "CORS preflight successful",
            "headers": {
              "Access-Control-Allow-Origin": {
                "description": "CORS header allowing all origins",
                "schema": {
                  "type": "string",
                  "examples": [
                    "*"
                  ]
                }
              },
              "Access-Control-Allow-Methods": {
                "description": "Allowed HTTP methods",
                "schema": {
                  "type": "string",
                  "examples": [
                    "GET, OPTIONS"
                  ]
                }
              },
              "Access-Control-Allow-Headers": {
                "description": "Allowed headers",
                "schema": {
                  "type": "string",
                  "examples": [
                    "Accept, Content-Type"
                  ]
                }
              },
              "Access-Control-Max-Age": {
                "description": "Cache duration for preflight response",
                "schema": {
                  "type": "string",
                  "examples": [
                    "86400"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/fragments/agentic-search": {
      "post": {
        "summary": "Agentic search for memory fragments",
        "description": "Perform intelligent iterative search for memory fragments using AI-powered semantic search with automatic expansion. This endpoint uses vector-based semantic search that understands meaning, not just keywords. It performs iterative expansion to find the most relevant fragments and provides a decision on whether sufficient information was found.",
        "tags": [
          "Fragments"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AgenticSearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Agentic search results with selected fragments",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgenticSearchResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/fragments/list": {
      "post": {
        "summary": "List memory fragments with filtering",
        "description": "List memory fragments with powerful SQL-like filtering capabilities. Supports traditional filters (tags, status, fragment type, dates) and advanced SQL WHERE clauses for complex queries. Returns metadata only (title, summary, tags, dates, author, fragment type) without full content - use GET /api/memory-fragments/{id} to fetch full content by ID.",
        "tags": [
          "Fragments"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ListFragmentsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "List of memory fragments matching the filters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListFragmentsResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/files/upload": {
      "post": {
        "summary": "Upload a file to a workspace",
        "description": "Upload a file to a workspace using multipart/form-data. The file is processed asynchronously using a fire-and-forget pattern. Returns immediately with a fileId for status polling. Files are chunked automatically by Flowcore Pathways for large uploads.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "file",
                  "workspaceId"
                ],
                "properties": {
                  "file": {
                    "type": "string",
                    "description": "File to upload (max 50MB)",
                    "contentMediaType": "application/octet-stream"
                  },
                  "workspaceId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "Workspace ID to upload the file to"
                  },
                  "tags": {
                    "type": "string",
                    "description": "JSON array or comma-separated list of tags. Example: '[\"document\", \"report\"]' or 'document,report'"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File upload initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fileId": {
                      "type": "string",
                      "description": "File ID for status polling and future operations",
                      "examples": [
                        "a1b2c3d4e5f6"
                      ]
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "uploading"
                      ],
                      "examples": [
                        "uploading"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "File upload initiated"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "fileId",
                    "status"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid file or missing required fields",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "File exceeds 50MB limit"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Insufficient permissions - requires fragments.write permission"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/files/search": {
      "get": {
        "summary": "Search files in a workspace",
        "description": "Search for files in a workspace by keyword, tags, or MIME type. Returns file metadata without file content.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Workspace ID to search files in"
          },
          {
            "name": "query",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Keyword search query to match against file names (case-insensitive partial matching)"
          },
          {
            "name": "tags",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "JSON array of tags. Files must have at least one of these tags"
            },
            "examples": {
              "default": {
                "value": "[\"document\", \"report\"]"
              }
            }
          },
          {
            "name": "mimeTypes",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "JSON array of MIME types to filter by"
            },
            "examples": {
              "default": {
                "value": "[\"application/pdf\", \"image/png\"]"
              }
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 50
            },
            "description": "Maximum number of files to return"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Number of files to skip for pagination"
          }
        ],
        "responses": {
          "200": {
            "description": "Files retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileSearchResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "Workspace not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "Workspace not found or access denied"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/files/{id}": {
      "get": {
        "summary": "Get file metadata",
        "description": "Retrieve file metadata by ID. Does not include file content.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "File ID"
          }
        ],
        "responses": {
          "200": {
            "description": "File metadata retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "file": {
                      "$ref": "#/components/schemas/FileMetadata"
                    }
                  },
                  "required": [
                    "success",
                    "file"
                  ]
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Access denied to file's workspace"
          },
          "404": {
            "description": "File not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "File not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "patch": {
        "summary": "Update file metadata",
        "description": "Update file name or tags. Processing happens asynchronously via Flowcore Pathways.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "File ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FileUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File update initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fileId": {
                      "type": "string"
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "processing"
                      ],
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "File update initiated"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "fileId",
                    "status"
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Insufficient permissions - requires fragments.write permission"
          },
          "404": {
            "description": "File not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete a file",
        "description": "Soft delete a file (marks as deleted, storage decremented in next billing period). Processing happens asynchronously via Flowcore Pathways.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "File ID"
          },
          {
            "name": "reason",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Optional reason for deletion"
          }
        ],
        "responses": {
          "200": {
            "description": "File deletion initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fileId": {
                      "type": "string"
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "processing"
                      ],
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "File deletion initiated"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "fileId",
                    "status"
                  ]
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Insufficient permissions - requires fragments.write permission and cannot be viewer role"
          },
          "404": {
            "description": "File not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/files/{id}/download": {
      "get": {
        "summary": "Download a file",
        "description": "Download a file by ID. Returns binary file data with appropriate Content-Type and Content-Disposition headers.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "File ID"
          }
        ],
        "responses": {
          "200": {
            "description": "File content",
            "content": {
              "application/octet-stream": {}
            },
            "headers": {
              "Content-Type": {
                "schema": {
                  "type": "string"
                },
                "description": "MIME type of the file"
              },
              "Content-Disposition": {
                "schema": {
                  "type": "string"
                },
                "description": "Attachment disposition with filename. Example: 'attachment; filename=\"document.pdf\"'"
              },
              "Content-Length": {
                "schema": {
                  "type": "integer"
                },
                "description": "File size in bytes"
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Access denied to file's workspace"
          },
          "404": {
            "description": "File not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "File not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/files/{id}/status": {
      "get": {
        "summary": "Get file upload status",
        "description": "Check the upload status of a file. Useful for polling after initiating an upload. Returns status and progress percentage.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "File ID"
          }
        ],
        "responses": {
          "200": {
            "description": "File status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "fileId": {
                      "type": "string",
                      "examples": [
                        "a1b2c3d4e5f6"
                      ]
                    },
                    "status": {
                      "$ref": "#/components/schemas/FileStatus"
                    }
                  },
                  "required": [
                    "success",
                    "fileId",
                    "status"
                  ]
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "File not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/files/{id}/attachments": {
      "post": {
        "summary": "Attach file to a fragment",
        "description": "Attach a file to a memory fragment. The file must exist and be accessible. The fragment must exist and the user must have update permissions. Processing happens asynchronously via Flowcore Pathways.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "File ID to attach"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FileAttachmentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File attachment initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "attachmentId": {
                      "type": "string",
                      "format": "uuid",
                      "description": "Attachment ID"
                    },
                    "fileId": {
                      "type": "string"
                    },
                    "fragmentId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "processing"
                      ],
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "File attachment initiated"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "attachmentId",
                    "status"
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Insufficient permissions - requires fragments.update permission"
          },
          "404": {
            "description": "File or fragment not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "Fragment not found or access denied"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Remove file attachment from fragment",
        "description": "Remove a file attachment from a memory fragment. Processing happens asynchronously via Flowcore Pathways.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "File ID"
          },
          {
            "name": "fragmentId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Fragment ID to remove the attachment from"
          },
          {
            "name": "attachmentId",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Optional attachment ID. If not provided, looks up by fileId and fragmentId"
          }
        ],
        "responses": {
          "200": {
            "description": "File attachment removal initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "attachmentId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "processing"
                      ],
                      "examples": [
                        "processing"
                      ]
                    },
                    "message": {
                      "type": "string",
                      "examples": [
                        "File attachment removal initiated"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "attachmentId",
                    "status"
                  ]
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Insufficient permissions - requires fragments.update permission"
          },
          "404": {
            "description": "Attachment or fragment not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "Attachment not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/fragments/{id}/files": {
      "get": {
        "summary": "Get files attached to a fragment",
        "description": "Retrieve all files attached to a specific memory fragment. Returns attachment metadata including file information.",
        "tags": [
          "Files"
        ],
        "security": [
          {
            "BearerAuth": []
          },
          {
            "SessionAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Fragment ID"
          }
        ],
        "responses": {
          "200": {
            "description": "File attachments retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "examples": [
                        true
                      ]
                    },
                    "attachments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/FileAttachment"
                      },
                      "description": "List of file attachments, sorted by displayOrder"
                    }
                  },
                  "required": [
                    "success",
                    "attachments"
                  ]
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError",
            "description": "Access denied to fragment"
          },
          "404": {
            "description": "Fragment not found or access denied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "default": {
                    "value": {
                      "error": "Fragment not found or access denied"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    }
  }
}